(function(){function z(){}function b(a){var b=P.call(arguments,1);return function(){return a.apply(this,b)}}function w(a,b){if(!b)throw Error("prayer failed: "+a);}function W(a,b,e,d){function n(){x=void 0;var a=h.selection?"$"+h.selection.latex()+"$":"";p.select(a)}var y=a.contents().detach();e||a.addClass("mathquill-rendered-math");b.jQ=a.attr("mathquill-block-id",b.id);b.revert=function(){a.empty().unbind(".mathquill").removeClass("mathquill-rendered-math mathquill-editable mathquill-textbox").append(y)};
var h=b.cursor=aa(b);b.renderLatex(y.text());var c=b.textarea=m('\x3cspan class\x3d"textarea"\x3e\x3ctextarea\x3e\x3c/textarea\x3e\x3c/span\x3e'),C=c.children(),x;b.selectionChanged=function(){void 0===x&&(x=setTimeout(n));X(a[0])};a.bind("selectstart.mathquill",function(a){a.target!==C[0]&&a.preventDefault();a.stopPropagation()});var g,k=h.blink;a.bind("mousedown.mathquill",function(e){function b(a){h.seek(m(a.target),a.pageX,a.pageY);h.prev===g.prev&&h.parent===g.parent||h.selectFrom(g);return!1}
function n(a){delete a.target;return b(a)}function u(e){g=void 0;h.blink=k;h.selection||(d?h.show():c.detach());a.unbind("mousemove",b);m(e.target.ownerDocument).unbind("mousemove",n).unbind("mouseup",u)}setTimeout(function(){C.focus()});h.blink=z;h.seek(m(e.target),e.pageX,e.pageY);g={parent:h.parent,prev:h.prev,next:h.next};d||a.prepend(c);a.mousemove(b);m(e.target.ownerDocument).mousemove(n).mouseup(u);return!1});if(d)p=Y(C,{container:a,key:function(a,e){h.parent.bubble("onKey",a,e)},text:function(a){h.parent.bubble("onText",
a)},cut:function(a){h.selection&&setTimeout(function(){h.prepareEdit();h.parent.bubble("redraw")});a.stopPropagation()},paste:function(a){a="$"===a.slice(0,1)&&"$"===a.slice(-1)?a.slice(1,-1):"\\text{"+a+"}";h.writeLatex(a).show()}}),a.prepend(c),a.addClass("mathquill-editable"),e&&a.addClass("mathquill-textbox"),C.focus(function(a){h.parent||h.appendTo(b);h.parent.jQ.addClass("hasCursor");h.selection?(h.selection.jQ.removeClass("blur"),setTimeout(b.selectionChanged)):h.show();a.stopPropagation()}).blur(function(a){h.hide().parent.blur();
h.selection&&h.selection.jQ.addClass("blur");a.stopPropagation()}),a.bind("focus.mathquill blur.mathquill",function(a){C.trigger(a)}).blur();else{var l=function(){c.detach()},p=Y(C,{container:a});a.bind("cut paste",!1).bind("copy",n).prepend('\x3cspan class\x3d"selectable"\x3e$'+b.latex()+"$\x3c/span\x3e");C.blur(function(){h.clearSelection();setTimeout(l)})}}function E(a,b,e){return g(J,{ctrlSeq:a,htmlTemplate:"\x3c"+b+" "+e+"\x3e\x260\x3c/"+b+"\x3e"})}var m=jQuery,Q=Math.min,P=[].slice,g=function(a,
b,e){function d(a){return"function"===typeof a}return function(n,y){function h(a){if(!(this instanceof h))return new h(arguments);a&&d(this.init)&&this.init.apply(this,a)}y===e&&(y=n,n=Object);var c=h[a]=new n,g=n[a],x,k=h.mixin=function(a){x={};d(a)?x=a.call(h,c,g,h,n):"object"===typeof a&&(x=a);if("object"===typeof x)for(var e in x)b.call(x,e)&&(c[e]=x[e]);d(c.init)||(c.init=function(){n.apply(this,arguments)});return h};c.constructor=h;return k(y)}}("prototype",{}.hasOwnProperty),Y=function(){function a(e){var d=
e.which||e.keyCode,f=b[d],c=[];e.ctrlKey&&c.push("Ctrl");e.originalEvent&&e.originalEvent.metaKey&&c.push("Meta");e.altKey&&c.push("Alt");e.shiftKey&&c.push("Shift");e=f||String.fromCharCode(d);if(!c.length&&!f)return e;c.push(e);return c.join("-")}var b={8:"Backspace",9:"Tab",10:"Enter",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Esc",32:"Spacebar",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Del",144:"NumLock"};return function(e,
d){function b(a){var e=q.val();q.val("");e&&a(e)}function c(){var a;a=q[0];a="selectionStart"in a?a.selectionStart!==a.selectionEnd:!1;a||b(x)}function h(){b(l)}var u=null,g=null;d||(d={});var x=d.text||z,k=d.key||z,l=d.paste||z,p=d.cut||z,q=m(e),t=m(d.container||q),r=z;t.bind("keydown keypress input keyup focusout paste",function(){r()});t.bind({keydown:function(e){u=e;g=null;k(a(u),u)},keypress:function(e){u&&g&&k(a(u),u);g=e;r=c;setTimeout(c)},focusout:function(){u=g=null},cut:p,paste:function(a){q.focus();
r=h;setTimeout(h)}});return{select:function(a){r();q.val(a);a&&q[0].select()}}}}(),p=g(function(a,b,e){function d(a,e){throw"Parse Error: "+e+" at "+(a?"'"+a+"'":"EOF");}a.init=function(a){this._=a};a.parse=function(a){return this.skip(c)._(a,function(a,e){return e},d)};a.or=function(a){w("or is passed a parser",a instanceof e);var d=this;return e(function(e,f,b){return d._(e,f,function(d){return a._(e,f,b)})})};a.then=function(a){var d=this;return e(function(f,b,n){return d._(f,function(d,f){var c=
a instanceof e?a:a(f);w("a parser is returned",c instanceof e);return c._(d,b,n)},n)})};a.many=function(){var a=this;return e(function(e,d,f){function b(a,d){e=a;c.push(d);return!0}function n(){return!1}for(var c=[];a._(e,b,n););return d(e,c)})};a.times=function(a,d){2>arguments.length&&(d=a);var f=this;return e(function(e,b,n){function c(a,d){g.push(d);e=a;return!0}function u(a,d){l=d;e=a;return!1}function y(a,e){return!1}for(var g=[],k=!0,l,m=0;m<a;m+=1)if(k=f._(e,c,u),!k)return n(e,l);for(;m<d&&
k;m+=1)k=f._(e,c,y);return b(e,g)})};a.result=function(a){return this.then(n(a))};a.atMost=function(a){return this.times(0,a)};a.atLeast=function(a){var e=this;return e.times(a).then(function(a){return e.many().map(function(e){return a.concat(e)})})};a.map=function(a){return this.then(function(e){return n(a(e))})};a.skip=function(a){return this.then(function(e){return a.result(e)})};this.string=function(a){var d=a.length,f="expected '"+a+"'";return e(function(e,b,n){var c=e.slice(0,d);return c===
a?b(e.slice(d),c):n(e,f)})};a=this.regex=function(a){w("regexp parser is anchored","^"===a.toString().charAt(1));var d="expected "+a;return e(function(e,f,b){var n=a.exec(e);return n?(b=n[0],f(e.slice(b.length),b)):b(e,d)})};var n=e.succeed=function(a){return e(function(e,d){return d(e,a)})};e.fail=function(a){return e(function(e,d,f){return f(e,a)})};e.letter=a(/^[a-z]/i);e.letters=a(/^[a-z]*/i);e.digit=a(/^[0-9]/);e.digits=a(/^[0-9]*/);e.whitespace=a(/^\s+/);e.optWhitespace=a(/^\s*/);e.any=e(function(a,
e,d){return a?e(a.slice(1),a.charAt(0)):d(a,"expected any character")});e.all=e(function(a,e,d){return e("",a)});var c=e.eof=e(function(a,e,d){return a?d(a,"expected EOF"):e(a,a)})}),R=g(function(a){a.prev=0;a.next=0;a.parent=0;a.firstChild=0;a.lastChild=0;a.children=function(){return L(this.firstChild,this.lastChild)};a.eachChild=function(a){return this.children().each(a)};a.foldChildren=function(a,e){return this.children().fold(a,e)};a.adopt=function(a,e,d){L(this,this).adopt(a,e,d);return this};
a.disown=function(){L(this,this).disown();return this}}),L=g(function(a){function b(a,d,f){w("a parent is always present",a);var c;c=d?d.next===f&&d.parent===a:a.firstChild===f;w("prev is properly set up",c);a=f?f.prev===d&&f.parent===a:a.lastChild===d;w("next is properly set up",a)}a.first=0;a.last=0;a.init=function(a,d){w("no half-empty fragments",!a===!d);a&&(w("first node is passed to Fragment",a instanceof R),w("last node is passed to Fragment",d instanceof R),w("first and last have the same parent",
a.parent===d.parent),this.first=a,this.last=d)};a.adopt=function(a,d,f){b(a,d,f);this.disowned=!1;var c=this.first;if(!c)return this;var h=this.last;d||(a.firstChild=c);f?f.prev=h:a.lastChild=h;this.last.next=f;this.each(function(f){f.prev=d;f.parent=a;d&&(d.next=f);d=f});return this};a.disown=function(){var a=this.first;if(!a||this.disowned)return this;this.disowned=!0;var d=this.last,f=a.parent;b(f,a.prev,a);b(f,d,d.next);a.prev?a.prev.next=d.next:f.firstChild=d.next;d.next?d.next.prev=a.prev:f.lastChild=
a.prev;return this};a.each=function(a){var d=this.first;if(!d)return this;for(;d!==this.last.next&&!1!==a.call(this,d);d=d.next);return this};a.fold=function(a,d){this.each(function(f){a=d.call(this,a,f)});return a}}),ba=function(){var a=0;return function(){return a+=1}}(),q=g(R,function(a){a.init=function(a){this.id=ba();q[this.id]=this};a.toString=function(){return"[MathElement "+this.id+"]"};a.bubble=function(a){for(var e=P.call(arguments,1),d=this;d&&!1!==(d[a]&&d[a].apply(d,e));d=d.parent);return this};
a.postOrder=function(a){P.call(arguments,1);if("string"===typeof a){var e=a;a=function(a){e in a&&a[e].apply(a,arguments)}}(function n(e){e.eachChild(n);a(e)})(this)};a.jQ=m();a.jQadd=function(a){this.jQ=this.jQ.add(a)};this.jQize=function(a){a=m(a);a.find("*").andSelf().each(function(){var a=m(this),d=a.attr("mathquill-command-id"),f=a.attr("mathquill-block-id");d&&q[d].jQadd(a);f&&q[f].jQadd(a)});return a};a.finalizeInsert=function(){this.postOrder("finalizeTree");this.postOrder("blur");this.postOrder("respace");
this.next.respace&&this.next.respace();this.prev.respace&&this.prev.respace();this.postOrder("redraw");this.bubble("redraw")}}),t=g(q,function(a,b){a.init=function(a,d,f){b.init.call(this);this.ctrlSeq||(this.ctrlSeq=a);d&&(this.htmlTemplate=d);f&&(this.textTemplate=f)};a.replaces=function(a){a.disown();this.replacedFragment=a};a.isEmpty=function(){return this.foldChildren(!0,function(a,d){return a&&d.isEmpty()})};a.parser=function(){var a=this;return F.block.times(a.numBlocks()).map(function(d){a.blocks=
d;for(var f=0;f<d.length;f+=1)d[f].adopt(a,a.lastChild,0);return a})};a.createBefore=function(a){var d=this.replacedFragment;this.createBlocks();q.jQize(this.html());d&&(d.adopt(this.firstChild,0,0),d.jQ.appendTo(this.firstChild.jQ));a.jQ.before(this.jQ);a.prev=this.adopt(a.parent,a.prev,a.next);this.finalizeInsert(a);this.placeCursor(a)};a.createBlocks=function(){for(var a=this.numBlocks(),d=this.blocks=Array(a),f=0;f<a;f+=1)(d[f]=A()).adopt(this,this.lastChild,0)};a.respace=z;a.placeCursor=function(a){a.appendTo(this.foldChildren(this.firstChild,
function(a,e){return a.isEmpty()?a:e}))};a.remove=function(){this.disown();this.jQ.remove();this.postOrder(function(a){delete q[a.id]});return this};a.numBlocks=function(){var a=this.htmlTemplate.match(/&\d+/g);return a?a.length:0};a.html=function(){var a=this.blocks,d=" mathquill-command-id\x3d"+this.id,f=this.htmlTemplate.match(/<[^<>]+>|[^<>]+/g);w("no unmatched angle brackets",f.join("")===this.htmlTemplate);for(var b=0,c=f[0];c;b+=1,c=f[b])if("/\x3e"===c.slice(-2))f[b]=c.slice(0,-2)+d+"/\x3e";
else if("\x3c"===c.charAt(0)){w("not an unmatched top-level close tag","/"!==c.charAt(1));f[b]=c.slice(0,-1)+d+"\x3e";var u=1;do b+=1,c=f[b],w("no missing close tags",c),"\x3c/"===c.slice(0,2)?--u:"\x3c"===c.charAt(0)&&"/\x3e"!==c.slice(-2)&&(u+=1);while(0<u)}return f.join("").replace(/>&(\d+)/g,function(d,f){return" mathquill-block-id\x3d"+a[f].id+"\x3e"+a[f].join("html")})};a.latex=function(){return this.foldChildren(this.ctrlSeq,function(a,d){return a+"{"+(d.latex()||" ")+"}"})};a.textTemplate=
[""];a.text=function(){var a=0;return this.foldChildren(this.textTemplate[a],function(d,f){a+=1;var b=f.text();return d&&"("===this.textTemplate[a]&&"("===b[0]&&")"===b.slice(-1)?d+b.slice(1,-1)+this.textTemplate[a]:d+f.text()+(this.textTemplate[a]||"")})}}),D=g(t,function(a,b){a.init=function(a,d,f){f||(f=a&&1<a.length?a.slice(1):a);b.init.call(this,a,d,[f])};a.parser=function(){return p.succeed(this)};a.numBlocks=function(){return 0};a.replaces=function(a){a.remove()};a.createBlocks=z;a.latex=function(){return this.ctrlSeq};
a.text=function(){return this.textTemplate};a.placeCursor=z;a.isEmpty=function(){return!0}}),A=g(q,function(a){a.join=function(a){return this.foldChildren("",function(e,d){return e+d[a]()})};a.latex=function(){return this.join("latex")};a.text=function(){return this.firstChild===this.lastChild?this.firstChild.text():"("+this.join("text")+")"};a.isEmpty=function(){return 0===this.firstChild&&0===this.lastChild};a.focus=function(){this.jQ.addClass("hasCursor");this.jQ.removeClass("empty");return this};
a.blur=function(){this.jQ.removeClass("hasCursor");this.isEmpty()&&this.jQ.addClass("empty");return this}}),M=g(L,function(a,b){a.init=function(a,d){b.init.call(this,a,d||a);this.jQ=this.fold(m(),function(a,e){return e.jQ.add(a)})};a.latex=function(){return this.fold("",function(a,d){return a+d.latex()})};a.remove=function(){this.jQ.remove();this.each(function(a){a.postOrder(function(a){delete q[a.id]})});return this.disown()}}),N=g(A,function(a,b){a.latex=function(){return b.latex.call(this).replace(/(\\[a-z]+) (?![a-z])/ig,
"$1")};a.text=function(){return this.foldChildren("",function(a,d){return a+d.text()})};a.renderLatex=function(a){this.jQ.children().slice(1).remove();this.firstChild=this.lastChild=0;this.cursor.appendTo(this).writeLatex(a)};a.onKey=function(a,d){switch(a){case "Ctrl-Shift-Backspace":case "Ctrl-Backspace":for(;this.cursor.prev||this.cursor.selection;)this.cursor.backspace();break;case "Shift-Backspace":case "Backspace":this.cursor.backspace();break;case "Esc":case "Tab":case "Spacebar":var b=this.cursor.parent;
if(b===this.cursor.root){"Spacebar"===a&&d.preventDefault();return}this.cursor.prepareMove();b.next?this.cursor.prependTo(b.next):this.cursor.insertAfter(b.parent);break;case "Shift-Tab":case "Shift-Esc":case "Shift-Spacebar":b=this.cursor.parent;if(b===this.cursor.root){"Shift-Spacebar"===a&&d.preventDefault();return}this.cursor.prepareMove();b.prev?this.cursor.appendTo(b.prev):this.cursor.insertBefore(b.parent);break;case "Enter":break;case "End":this.cursor.prepareMove().appendTo(this.cursor.parent);
break;case "Ctrl-End":this.cursor.prepareMove().appendTo(this);break;case "Shift-End":for(;this.cursor.next;)this.cursor.selectRight();break;case "Ctrl-Shift-End":for(;this.cursor.next||this.cursor.parent!==this;)this.cursor.selectRight();break;case "Home":this.cursor.prepareMove().prependTo(this.cursor.parent);break;case "Ctrl-Home":this.cursor.prepareMove().prependTo(this);break;case "Shift-Home":for(;this.cursor.prev;)this.cursor.selectLeft();break;case "Ctrl-Shift-Home":for(;this.cursor.prev||
this.cursor.parent!==this;)this.cursor.selectLeft();break;case "Left":this.cursor.moveLeft();break;case "Shift-Left":this.cursor.selectLeft();break;case "Ctrl-Left":break;case "Right":this.cursor.moveRight();break;case "Shift-Right":this.cursor.selectRight();break;case "Ctrl-Right":break;case "Up":this.cursor.moveUp();break;case "Down":this.cursor.moveDown();break;case "Shift-Up":if(this.cursor.prev)for(;this.cursor.prev;)this.cursor.selectLeft();else this.cursor.selectLeft();case "Shift-Down":if(this.cursor.next)for(;this.cursor.next;)this.cursor.selectRight();
else this.cursor.selectRight();case "Ctrl-Up":break;case "Ctrl-Down":break;case "Ctrl-Shift-Del":case "Ctrl-Del":for(;this.cursor.next||this.cursor.selection;)this.cursor.deleteForward();break;case "Shift-Del":case "Del":this.cursor.deleteForward();break;case "Meta-A":case "Ctrl-A":if(this!==this.cursor.root)return;for(this.cursor.prepareMove().appendTo(this);this.cursor.prev;)this.cursor.selectLeft();break;default:return!1}d.preventDefault();return!1};a.onText=function(a){this.cursor.write(a);return!1}}),
S=g(t,function(a,b){a.init=function(a){b.init.call(this,"$");this.cursor=a};a.htmlTemplate='\x3cspan class\x3d"mathquill-rendered-math"\x3e\x260\x3c/span\x3e';a.createBlocks=function(){this.firstChild=this.lastChild=N();this.blocks=[this.firstChild];this.firstChild.parent=this;var a=this.firstChild.cursor=this.cursor;this.firstChild.onText=function(d){"$"!==d||a.parent!==this?a.write(d):this.isEmpty()?a.insertAfter(this.parent).backspace().insertNew(c("\\$","$")).show():a.next?a.prev?a.write(d):a.insertBefore(this.parent):
a.insertAfter(this.parent);return!1}};a.latex=function(){return"$"+this.firstChild.latex()+"$"}}),ca=g(A,function(a){a.renderLatex=function(a){var e=this.cursor;this.jQ.children().slice(1).remove();this.firstChild=this.lastChild=0;e.show().appendTo(this);var d=p.regex,b=p.string,f=p.eof,h=p.all,g=b("$").then(F).skip(b("$").or(f)).map(function(a){var d=S(e);d.createBlocks();var b=d.firstChild;a.children().adopt(b,0,0);return d}),d=b("\\$").result("$").or(d(/^[^$]/)).map(c);if(a=g.or(d).many().skip(f).or(h.result(!1)).parse(a)){for(f=
0;f<a.length;f+=1)a[f].adopt(this,this.lastChild,0);a=this.join("html");q.jQize(a).appendTo(this.jQ);this.finalizeInsert()}};a.onKey=N.prototype.onKey;a.onText=function(a){this.cursor.prepareEdit();"$"===a?this.cursor.insertNew(S(this.cursor)):this.cursor.insertNew(c(a));return!1}}),r={},a={},H,X=z,l=document.createElement("div").style,G={transform:1,WebkitTransform:1,MozTransform:1,OTransform:1,msTransform:1},T,U;for(U in G)if(U in l){T=U;break}T?H=function(a,b,e){a.css(T,"scale("+b+","+e+")")}:
"filter"in l?(X=function(a){a.className=a.className},H=function(a,b,e){function d(){a.css("marginRight",(c.width()-1)*(b-1)/b+"px")}b/=1+(e-1)/2;a.css("fontSize",e+"em");a.hasClass("matrixed-container")||a.addClass("matrixed-container").wrapInner('\x3cspan class\x3d"matrixed"\x3e\x3c/span\x3e');var c=a.children().css("filter","progid:DXImageTransform.Microsoft.Matrix(M11\x3d"+b+",SizingMethod\x3d'auto expand')");d();var y=setInterval(d);m(window).load(function(){clearTimeout(y);d()})}):H=function(a,
b,e){a.css("fontSize",e+"em")};l=g(t,function(a,b){a.init=function(a,d,f){b.init.call(this,a,"\x3c"+d+" "+f+"\x3e\x260\x3c/"+d+"\x3e")}});a.mathrm=b(l,"\\mathrm","span",'class\x3d"roman font"');a.mathit=b(l,"\\mathit","i",'class\x3d"font"');a.mathbf=b(l,"\\mathbf","b",'class\x3d"font"');a.mathsf=b(l,"\\mathsf","span",'class\x3d"sans-serif font"');a.mathtt=b(l,"\\mathtt","span",'class\x3d"monospace font"');a.underline=b(l,"\\underline","span",'class\x3d"non-leaf underline"');a.overline=a.bar=b(l,"\\overline",
"span",'class\x3d"non-leaf overline"');var B=g(t,function(a,b){a.init=function(a,d,f){b.init.call(this,a,"\x3c"+d+' class\x3d"non-leaf"\x3e\x260\x3c/'+d+"\x3e",[f])};a.finalizeTree=function(){function a(d){var e=this.parent,b=d;do{if(b.next)return d.insertBefore(e),!1;b=b.parent.parent}while(b!==e);d.insertAfter(e);return!1}w("SupSub is only _ and ^","^"===this.ctrlSeq||"_"===this.ctrlSeq);"_"===this.ctrlSeq?(this.down=this.firstChild,this.firstChild.up=a):(this.up=this.firstChild,this.firstChild.down=
a)};a.latex=function(){var a=this.firstChild.latex();return 1===a.length?this.ctrlSeq+a:this.ctrlSeq+"{"+(a||" ")+"}"};a.redraw=function(){this.prev&&this.prev.respace();this.prev instanceof B||(this.respace(),!this.next||this.next instanceof B||this.next.respace())};a.respace=function(){"\\int "===this.prev.ctrlSeq||this.prev instanceof B&&this.prev.ctrlSeq!=this.ctrlSeq&&this.prev.prev&&"\\int "===this.prev.prev.ctrlSeq?this.limit||(this.limit=!0,this.jQ.addClass("limit")):this.limit&&(this.limit=
!1,this.jQ.removeClass("limit"));if(this.respaced=this.prev instanceof B&&this.prev.ctrlSeq!=this.ctrlSeq&&!this.prev.respaced){var a=+this.jQ.css("fontSize").slice(0,-2),d=this.prev.jQ.outerWidth(),b=this.jQ.outerWidth();this.jQ.css({left:(this.limit&&"_"===this.ctrlSeq?-.25:0)-d/a+"em",marginRight:.1-Q(b,d)/a+"em"})}else this.limit&&"_"===this.ctrlSeq?this.jQ.css({left:"-.25em",marginRight:""}):this.jQ.css({left:"",marginRight:""});this.next instanceof B&&this.next.respace();return this}});a.subscript=
a._=b(B,"_","sub","_");a.superscript=a.supscript=a["^"]=b(B,"^","sup","**");var l=a.frac=a.dfrac=a.cfrac=a.fraction=g(t,function(a,b){a.ctrlSeq="\\frac";a.htmlTemplate='\x3cspan class\x3d"fraction non-leaf"\x3e\x3cspan class\x3d"numerator"\x3e\x260\x3c/span\x3e\x3cspan class\x3d"denominator"\x3e\x261\x3c/span\x3e\x3cspan style\x3d"display:inline-block;width:0"\x3e\x26nbsp;\x3c/span\x3e\x3c/span\x3e';a.textTemplate=["(","/",")"];a.finalizeTree=function(){this.up=this.lastChild.up=this.firstChild;this.down=
this.firstChild.down=this.lastChild}}),da=a.over=r["/"]=g(l,function(a,b){a.createBefore=function(a){if(!this.replacedFragment){for(var d=a.prev;d&&!(d instanceof k||d instanceof J||d instanceof I);)d=d.prev;d instanceof I&&d.next instanceof B&&(d=d.next,d.next instanceof B&&d.next.ctrlSeq!=d.ctrlSeq&&(d=d.next));d!==a.prev&&(this.replaces(M(d.next||a.parent.firstChild,a.prev)),a.prev=d)}b.createBefore.call(this,a)}}),l=a.sqrt=a["√"]=g(t,function(a,b){a.ctrlSeq="\\sqrt";a.htmlTemplate='\x3cspan class\x3d"non-leaf"\x3e\x3cspan class\x3d"scaled sqrt-prefix"\x3e\x26radic;\x3c/span\x3e\x3cspan class\x3d"non-leaf sqrt-stem"\x3e\x260\x3c/span\x3e\x3c/span\x3e';
a.textTemplate=["sqrt(",")"];a.parser=function(){return F.optBlock.then(function(a){return F.block.map(function(d){var b=ea();b.blocks=[a,d];a.adopt(b,0,0);d.adopt(b,a,0);return b})}).or(b.parser.call(this))};a.redraw=function(){var a=this.lastChild.jQ;H(a.prev(),1,a.innerHeight()/+a.css("fontSize").slice(0,-2)-.1)}}),ea=a.nthroot=g(l,function(a,b){a.htmlTemplate='\x3csup class\x3d"nthroot non-leaf"\x3e\x260\x3c/sup\x3e\x3cspan class\x3d"scaled"\x3e\x3cspan class\x3d"sqrt-prefix scaled"\x3e\x26radic;\x3c/span\x3e\x3cspan class\x3d"sqrt-stem non-leaf"\x3e\x261\x3c/span\x3e\x3c/span\x3e';
a.textTemplate=["sqrt[","](",")"];a.latex=function(){return"\\sqrt["+this.firstChild.latex()+"]{"+this.lastChild.latex()+"}"}}),K=g(t,function(a,b){a.init=function(a,d,f,c){b.init.call(this,"\\left"+f,'\x3cspan class\x3d"non-leaf"\x3e\x3cspan class\x3d"scaled paren"\x3e'+a+'\x3c/span\x3e\x3cspan class\x3d"non-leaf"\x3e\x260\x3c/span\x3e\x3cspan class\x3d"scaled paren"\x3e'+d+"\x3c/span\x3e\x3c/span\x3e",[a,d]);this.end="\\right"+c};a.jQadd=function(){b.jQadd.apply(this,arguments);var a=this.jQ;this.bracketjQs=
a.children(":first").add(a.children(":last"))};a.latex=function(){return this.ctrlSeq+this.firstChild.latex()+this.end};a.redraw=function(){var a=this.firstChild.jQ,a=a.outerHeight()/+a.css("fontSize").slice(0,-2);H(this.bracketjQs,Q(1+.2*(a-1),1.2),1.05*a)}});a.left=g(t,function(a){a.parser=function(){var a=p.regex,b=p.string,a=p.regex,d=p.succeed,f=p.optWhitespace;return f.then(a(/^(?:[([|]|\\\{)/)).then(function(c){"\\"===c.charAt(0)&&(c=c.slice(1));var h=r[c]();return F.map(function(a){h.blocks=
[a];a.adopt(h,0,0)}).then(b("\\right")).skip(f).then(a(/^(?:[\])|]|\\\})/)).then(function(a){return a.slice(-1)!==h.end.slice(-1)?p.fail("open doesn't match close"):d(h)})})}});a.right=g(t,function(a){a.parser=function(){return p.fail("unmatched \\right")}});a.lbrace=r["{"]=b(K,"{","}","\\{","\\}");a.langle=a.lang=b(K,"\x26lang;","\x26rang;","\\langle ","\\rangle ");var O=g(K,function(a,b){a.createBefore=function(a){a.next||!a.parent.parent||a.parent.parent.end!==this.end||this.replacedFragment?b.createBefore.call(this,
a):a.insertAfter(a.parent.parent)};a.placeCursor=function(a){this.firstChild.blur();a.insertAfter(this)}});a.rbrace=r["}"]=b(O,"{","}","\\{","\\}");a.rangle=a.rang=b(O,"\x26lang;","\x26rang;","\\langle ","\\rangle ");G=function(a,b){a.init=function(a,d){b.init.call(this,a,d,a,d)}};l=g(K,G);a.lparen=r["("]=b(l,"(",")");a.lbrack=a.lbracket=r["["]=b(l,"[","]");G=g(O,G);a.rparen=r[")"]=b(G,"(",")");a.rbrack=a.rbracket=r["]"]=b(G,"[","]");a.lpipe=a.rpipe=r["|"]=g(l,function(a,b){a.init=function(){b.init.call(this,
"|","|")};a.createBefore=O.prototype.createBefore});var J=r.$=a.text=a.textnormal=a.textrm=a.textup=a.textmd=g(t,function(a,b){a.ctrlSeq="\\text";a.htmlTemplate='\x3cspan class\x3d"text"\x3e\x260\x3c/span\x3e';a.replaces=function(a){a instanceof M?this.replacedText=a.remove().jQ.text():"string"===typeof a&&(this.replacedText=a)};a.textTemplate=['"','"'];a.parser=function(){var a=p.string,d=p.regex;return p.optWhitespace.then(a("{")).then(d(/^[^}]*/)).skip(a("}")).map(function(a){var d=J();d.createBlocks();
for(var b=d.firstChild,e=0;e<a.length;e+=1)c(a.charAt(e)).adopt(b,b.lastChild,0);return d})};a.createBlocks=function(){this.firstChild=this.lastChild=fa();this.blocks=[this.firstChild];this.firstChild.parent=this};a.finalizeInsert=function(){this.firstChild.blur=function(){delete this.blur;return this};b.finalizeInsert.call(this)};a.createBefore=function(a){b.createBefore.call(this,this.cursor=a);if(this.replacedText)for(a=0;a<this.replacedText.length;a+=1)this.write(this.replacedText.charAt(a))};
a.write=function(a){this.cursor.insertNew(c(a))};a.onKey=function(a,d){if(!this.cursor.selection&&("Backspace"===a&&!this.cursor.prev||"Del"===a&&!this.cursor.next))return this.isEmpty()&&this.cursor.insertAfter(this),!1};a.onText=function(a){this.cursor.prepareEdit();"$"!==a?this.write(a):this.isEmpty()?this.cursor.insertAfter(this).backspace().insertNew(c("\\$","$")):this.cursor.next?this.cursor.prev?(a=J(M(this.cursor.next,this.firstChild.lastChild)),a.placeCursor=function(a){this.prev=0;delete this.placeCursor;
this.placeCursor(a)},a.firstChild.focus=function(){return this},this.cursor.insertAfter(this).insertNew(a),a.prev=this,this.cursor.insertBefore(a),delete a.firstChild.focus):this.cursor.insertBefore(this):this.cursor.insertAfter(this);return!1}}),fa=g(A,function(a,b){a.blur=function(){this.jQ.removeClass("hasCursor");if(this.isEmpty()){var a=this.parent,d=a.cursor;d.parent===this?this.jQ.addClass("empty"):(d.hide(),a.remove(),d.next===a?d.next=a.next:d.prev===a&&(d.prev=a.prev),d.show().parent.bubble("redraw"))}return this};
a.focus=function(){b.focus.call(this);var a=this.parent;if(a.next.ctrlSeq===a.ctrlSeq){var d=this,f=a.cursor,a=a.next.firstChild;a.eachChild(function(a){a.parent=d;a.jQ.appendTo(d.jQ)});this.lastChild?this.lastChild.next=a.firstChild:this.firstChild=a.firstChild;a.firstChild.prev=this.lastChild;this.lastChild=a.lastChild;a.parent.remove();f.prev?f.insertAfter(f.prev):f.prependTo(this);f.parent.bubble("redraw")}else a.prev.ctrlSeq===a.ctrlSeq&&(f=a.cursor,f.prev?a.prev.firstChild.focus():f.appendTo(a.prev.firstChild));
return this}});a.em=a.italic=a.italics=a.emph=a.textit=a.textsl=E("\\textit","i",'class\x3d"text"');a.strong=a.bold=a.textbf=E("\\textbf","b",'class\x3d"text"');a.sf=a.textsf=E("\\textsf","span",'class\x3d"sans-serif text"');a.tt=a.texttt=E("\\texttt","span",'class\x3d"monospace text"');a.textsc=E("\\textsc","span",'style\x3d"font-variant:small-caps" class\x3d"text"');a.uppercase=E("\\uppercase","span",'style\x3d"text-transform:uppercase" class\x3d"text"');a.lowercase=E("\\lowercase","span",'style\x3d"text-transform:lowercase" class\x3d"text"');
r["\\"]=g(t,function(a,b){a.ctrlSeq="\\";a.replaces=function(a){this._replacedFragment=a.disown();this.isEmpty=function(){return!1}};a.htmlTemplate='\x3cspan class\x3d"latex-command-input non-leaf"\x3e\\\x3cspan\x3e\x260\x3c/span\x3e\x3c/span\x3e';a.textTemplate=["\\"];a.createBlocks=function(){b.createBlocks.call(this);this.firstChild.focus=function(){this.parent.jQ.addClass("hasCursor");this.isEmpty()&&this.parent.jQ.removeClass("empty");return this};this.firstChild.blur=function(){this.parent.jQ.removeClass("hasCursor");
this.isEmpty()&&this.parent.jQ.addClass("empty");return this}};a.createBefore=function(a){b.createBefore.call(this,a);this.cursor=a.appendTo(this.firstChild);if(this._replacedFragment){var d=this.jQ[0];this.jQ=this._replacedFragment.jQ.addClass("blur").bind("mousedown mousemove",function(a){m(a.target=d).trigger(a);return!1}).insertBefore(this.jQ).add(this.jQ)}};a.latex=function(){return"\\"+this.firstChild.latex()+" "};a.onKey=function(a,d){if("Tab"===a||"Enter"===a||"Spacebar"===a)return this.renderCommand(),
d.preventDefault(),!1};a.onText=function(a){if(a.match(/[a-z]/i))return this.cursor.prepareEdit(),this.cursor.insertNew(c(a)),!1;this.renderCommand();if("\\"===a&&this.firstChild.isEmpty())return!1};a.renderCommand=function(){this.jQ=this.jQ.last();this.remove();this.next?this.cursor.insertBefore(this.next):this.cursor.appendTo(this.parent);var a=this.firstChild.latex();a||(a="backslash");this.cursor.insertCmd(a,this._replacedFragment)}});l=a.binom=a.binomial=g(t,function(a,b){a.ctrlSeq="\\binom";
a.htmlTemplate='\x3cspan class\x3d"paren scaled"\x3e(\x3c/span\x3e\x3cspan class\x3d"non-leaf"\x3e\x3cspan class\x3d"array non-leaf"\x3e\x3cspan\x3e\x260\x3c/span\x3e\x3cspan\x3e\x261\x3c/span\x3e\x3c/span\x3e\x3c/span\x3e\x3cspan class\x3d"paren scaled"\x3e)\x3c/span\x3e';a.textTemplate=["choose(",",",")"];a.redraw=function(){var a=this.jQ.eq(1),a=a.outerHeight()/+a.css("fontSize").slice(0,-2),d=this.jQ.filter(".paren");H(d,Q(1+.2*(a-1),1.2),1.05*a)}});a.choose=g(l,function(a){a.createBefore=da.prototype.createBefore});
a.vector=g(t,function(a,b){a.ctrlSeq="\\vector";a.htmlTemplate='\x3cspan class\x3d"array"\x3e\x3cspan\x3e\x260\x3c/span\x3e\x3c/span\x3e';a.latex=function(){return"\\begin{matrix}"+this.foldChildren([],function(a,d){a.push(d.latex());return a}).join("\\\\")+"\\end{matrix}"};a.text=function(){return"["+this.foldChildren([],function(a,d){a.push(d.text());return a}).join()+"]"};a.createBefore=function(a){b.createBefore.call(this,this.cursor=a)};a.onKey=function(a,d){var b=this.cursor.parent;if(b.parent===
this){if("Enter"===a){var c=A();c.parent=this;c.jQ=m("\x3cspan\x3e\x3c/span\x3e").attr("mathquill-block-id",c.id).insertAfter(b.jQ);b.next?b.next.prev=c:this.lastChild=c;c.next=b.next;b.next=c;c.prev=b;this.bubble("redraw").cursor.appendTo(c);d.preventDefault();return!1}if("Tab"===a&&!b.next){if(b.isEmpty()){if(b.prev)return this.cursor.insertAfter(this),delete b.prev.next,this.lastChild=b.prev,b.jQ.remove(),this.bubble("redraw"),d.preventDefault(),!1;return}c=A();c.parent=this;c.jQ=m("\x3cspan\x3e\x3c/span\x3e").attr("mathquill-block-id",
c.id).appendTo(this.jQ);this.lastChild=c;b.next=c;c.prev=b;this.bubble("redraw").cursor.appendTo(c);d.preventDefault();return!1}if(8===d.which){if(b.isEmpty())return b.prev?(this.cursor.appendTo(b.prev),b.prev.next=b.next):(this.cursor.insertBefore(this),this.firstChild=b.next),b.next?b.next.prev=b.prev:this.lastChild=b.prev,b.jQ.remove(),this.isEmpty()?this.cursor.deleteForward():this.bubble("redraw"),d.preventDefault(),!1;if(!this.cursor.prev)return d.preventDefault(),!1}}}});a.editable=g(S,function(a,
b){a.init=function(){t.prototype.init.call(this,"\\editable")};a.jQadd=function(){b.jQadd.apply(this,arguments);var a=this.firstChild.disown(),d=this.jQ.children().detach();this.firstChild=this.lastChild=N();this.blocks=[this.firstChild];this.firstChild.parent=this;W(this.jQ,this.firstChild,!1,!0);this.cursor=this.firstChild.cursor;a.children().adopt(this.firstChild,0,0);d.appendTo(this.firstChild.jQ);this.firstChild.cursor.appendTo(this.firstChild)};a.latex=function(){return this.firstChild.latex()};
a.text=function(){return this.firstChild.text()}});a.f=b(D,"f",'\x3cvar class\x3d"florin"\x3e\x26fnof;\x3c/var\x3e\x3cspan style\x3d"display:inline-block;width:0"\x3e\x26nbsp;\x3c/span\x3e');var v=g(D,function(a,b){a.init=function(a,d){b.init.call(this,a,"\x3cvar\x3e"+(d||a)+"\x3c/var\x3e")};a.text=function(){var a=this.ctrlSeq;!this.prev||this.prev instanceof v||this.prev instanceof k||(a="*"+a);!this.next||this.next instanceof k||"^"===this.next.ctrlSeq||(a+="*");return a}}),c=g(D,function(a,b){a.init=
function(a,d){b.init.call(this,a,"\x3cspan\x3e"+(d||a)+"\x3c/span\x3e")}});r[" "]=b(c,"\\:"," ");a.prime=r["'"]=b(c,"'","\x26prime;");l=g(D,function(a,b){a.init=function(a,d){b.init.call(this,a,'\x3cspan class\x3d"nonSymbola"\x3e'+(d||a)+"\x3c/span\x3e")}});a["@"]=l;a["\x26"]=b(l,"\\\x26","\x26amp;");a["%"]=b(l,"\\%","%");a.alpha=a.beta=a.gamma=a.delta=a.zeta=a.eta=a.theta=a.iota=a.kappa=a.mu=a.nu=a.xi=a.rho=a.sigma=a.tau=a.chi=a.psi=a.omega=g(v,function(a,b){a.init=function(a){b.init.call(this,"\\"+
a+" ","\x26"+a+";")}});a.phi=b(v,"\\phi ","\x26#981;");a.phiv=a.varphi=b(v,"\\varphi ","\x26phi;");a.epsilon=b(v,"\\epsilon ","\x26#1013;");a.epsiv=a.varepsilon=b(v,"\\varepsilon ","\x26epsilon;");a.piv=a.varpi=b(v,"\\varpi ","\x26piv;");a.sigmaf=a.sigmav=a.varsigma=b(v,"\\varsigma ","\x26sigmaf;");a.thetav=a.vartheta=a.thetasym=b(v,"\\vartheta ","\x26thetasym;");a.upsilon=a.upsi=b(v,"\\upsilon ","\x26upsilon;");a.gammad=a.Gammad=a.digamma=b(v,"\\digamma ","\x26#989;");a.kappav=a.varkappa=b(v,"\\varkappa ",
"\x26#1008;");a.rhov=a.varrho=b(v,"\\varrho ","\x26#1009;");a.pi=a["π"]=b(l,"\\pi ","\x26pi;");a.lambda=b(l,"\\lambda ","\x26lambda;");a.Upsilon=a.Upsi=a.upsih=a.Upsih=b(D,"\\Upsilon ",'\x3cvar style\x3d"font-family: serif"\x3e\x26upsih;\x3c/var\x3e');a.Gamma=a.Delta=a.Theta=a.Lambda=a.Xi=a.Pi=a.Sigma=a.Phi=a.Psi=a.Omega=a.forall=g(c,function(a,b){a.init=function(a){b.init.call(this,"\\"+a+" ","\x26"+a+";")}});l=g(t,function(a){a.init=function(a){this.latex=a};a.createBefore=function(a){a.writeLatex(this.latex)};
a.parser=function(){var a=F.parse(this.latex).children();return p.succeed(a)}});a["¹"]=b(l,"^1");a["²"]=b(l,"^2");a["³"]=b(l,"^3");a["¼"]=b(l,"\\frac14");a["½"]=b(l,"\\frac12");a["¾"]=b(l,"\\frac34");var k=g(D,function(a,b){a.init=function(a,d,c){b.init.call(this,a,'\x3cspan class\x3d"binary-operator"\x3e'+d+"\x3c/span\x3e",c)}}),l=g(k,function(a){a.init=c.prototype.init;a.respace=function(){this.jQ[0].className=this.prev?this.prev instanceof k&&this.next&&!(this.next instanceof k)?"unary-operator":
"binary-operator":"";return this}});a["+"]=b(l,"+","+");a["–"]=a["-"]=b(l,"-","\x26minus;");a["±"]=a.pm=a.plusmn=a.plusminus=b(l,"\\pm ","\x26plusmn;");a.mp=a.mnplus=a.minusplus=b(l,"\\mp ","\x26#8723;");r["*"]=a.sdot=a.cdot=b(k,"\\cdot ","\x26middot;");a["\x3d"]=b(k,"\x3d","\x3d");a["\x3c"]=b(k,"\x3c","\x26lt;");a["\x3e"]=b(k,"\x3e","\x26gt;");a.notin=a.sim=a.cong=a.equiv=a.oplus=a.otimes=g(k,function(a,b){a.init=function(a){b.init.call(this,"\\"+a+" ","\x26"+a+";")}});a.times=b(k,"\\times ","\x26times;",
"[x]");a["÷"]=a.div=a.divide=a.divides=b(k,"\\div ","\x26divide;","[/]");a["≠"]=a.ne=a.neq=b(k,"\\ne ","\x26ne;");a.ast=a.star=a.loast=a.lowast=b(k,"\\ast ","\x26lowast;");a.therefor=a.therefore=b(k,"\\therefore ","\x26there4;");a.cuz=a.because=b(k,"\\because ","\x26#8757;");a.prop=a.propto=b(k,"\\propto ","\x26prop;");a["≈"]=a.asymp=a.approx=b(k,"\\approx ","\x26asymp;");a.lt=b(k,"\x3c","\x26lt;");a.gt=b(k,"\x3e","\x26gt;");a["≤"]=a.le=a.leq=b(k,"\\le ","\x26le;");a["≥"]=a.ge=a.geq=b(k,"\\ge ","\x26ge;");
a.isin=a["in"]=b(k,"\\in ","\x26isin;");a.ni=a.contains=b(k,"\\ni ","\x26ni;");a.notni=a.niton=a.notcontains=a.doesnotcontain=b(k,"\\not\\ni ","\x26#8716;");a.sub=a.subset=b(k,"\\subset ","\x26sub;");a.sup=a.supset=a.superset=b(k,"\\supset ","\x26sup;");a.nsub=a.notsub=a.nsubset=a.notsubset=b(k,"\\not\\subset ","\x26#8836;");a.nsup=a.notsup=a.nsupset=a.notsupset=a.nsuperset=a.notsuperset=b(k,"\\not\\supset ","\x26#8837;");a.sube=a.subeq=a.subsete=a.subseteq=b(k,"\\subseteq ","\x26sube;");a.supe=a.supeq=
a.supsete=a.supseteq=a.supersete=a.superseteq=b(k,"\\supseteq ","\x26supe;");a.nsube=a.nsubeq=a.notsube=a.notsubeq=a.nsubsete=a.nsubseteq=a.notsubsete=a.notsubseteq=b(k,"\\not\\subseteq ","\x26#8840;");a.nsupe=a.nsupeq=a.notsupe=a.notsupeq=a.nsupsete=a.nsupseteq=a.notsupsete=a.notsupseteq=a.nsupersete=a.nsuperseteq=a.notsupersete=a.notsuperseteq=b(k,"\\not\\supseteq ","\x26#8841;");var I=g(D,function(a,b){a.init=function(a,d){b.init.call(this,a,"\x3cbig\x3e"+d+"\x3c/big\x3e")}});a["∑"]=a.sum=a.summation=
b(I,"\\sum ","\x26sum;");a["∏"]=a.prod=a.product=b(I,"\\prod ","\x26prod;");a.coprod=a.coproduct=b(I,"\\coprod ","\x26#8720;");a["∫"]=a["int"]=a.integral=b(I,"\\int ","\x26int;");a.N=a.naturals=a.Naturals=b(c,"\\mathbb{N}","\x26#8469;");a.P=a.primes=a.Primes=a.projective=a.Projective=a.probability=a.Probability=b(c,"\\mathbb{P}","\x26#8473;");a.Z=a.integers=a.Integers=b(c,"\\mathbb{Z}","\x26#8484;");a.Q=a.rationals=a.Rationals=b(c,"\\mathbb{Q}","\x26#8474;");a.R=a.reals=a.Reals=b(c,"\\mathbb{R}",
"\x26#8477;");a.C=a.complex=a.Complex=a.complexes=a.Complexes=a.complexplane=a.Complexplane=a.ComplexPlane=b(c,"\\mathbb{C}","\x26#8450;");a.H=a.Hamiltonian=a.quaternions=a.Quaternions=b(c,"\\mathbb{H}","\x26#8461;");a.quad=a.emsp=b(c,"\\quad ","    ");a.qquad=b(c,"\\qquad ","        ");a.diamond=b(c,"\\diamond ","\x26#9671;");a.bigtriangleup=b(c,"\\bigtriangleup ","\x26#9651;");a.ominus=b(c,"\\ominus ","\x26#8854;");a.uplus=b(c,"\\uplus ","\x26#8846;");a.bigtriangledown=b(c,"\\bigtriangledown ",
"\x26#9661;");a.sqcap=b(c,"\\sqcap ","\x26#8851;");a.triangleleft=b(c,"\\triangleleft ","\x26#8882;");a.sqcup=b(c,"\\sqcup ","\x26#8852;");a.triangleright=b(c,"\\triangleright ","\x26#8883;");a.odot=b(c,"\\odot ","\x26#8857;");a.bigcirc=b(c,"\\bigcirc ","\x26#9711;");a.dagger=b(c,"\\dagger ","\x26#0134;");a.ddagger=b(c,"\\ddagger ","\x26#135;");a.wr=b(c,"\\wr ","\x26#8768;");a.amalg=b(c,"\\amalg ","\x26#8720;");a.models=b(c,"\\models ","\x26#8872;");a.prec=b(c,"\\prec ","\x26#8826;");a.succ=b(c,"\\succ ",
"\x26#8827;");a.preceq=b(c,"\\preceq ","\x26#8828;");a.succeq=b(c,"\\succeq ","\x26#8829;");a.simeq=b(c,"\\simeq ","\x26#8771;");a.mid=b(c,"\\mid ","\x26#8739;");a.ll=b(c,"\\ll ","\x26#8810;");a.gg=b(c,"\\gg ","\x26#8811;");a.parallel=b(c,"\\parallel ","\x26#8741;");a.bowtie=b(c,"\\bowtie ","\x26#8904;");a.sqsubset=b(c,"\\sqsubset ","\x26#8847;");a.sqsupset=b(c,"\\sqsupset ","\x26#8848;");a.smile=b(c,"\\smile ","\x26#8995;");a.sqsubseteq=b(c,"\\sqsubseteq ","\x26#8849;");a.sqsupseteq=b(c,"\\sqsupseteq ",
"\x26#8850;");a.doteq=b(c,"\\doteq ","\x26#8784;");a.frown=b(c,"\\frown ","\x26#8994;");a.vdash=b(c,"\\vdash ","\x26#8870;");a.dashv=b(c,"\\dashv ","\x26#8867;");a.longleftarrow=b(c,"\\longleftarrow ","\x26#8592;");a.longrightarrow=b(c,"\\longrightarrow ","\x26#8594;");a.Longleftarrow=b(c,"\\Longleftarrow ","\x26#8656;");a.Longrightarrow=b(c,"\\Longrightarrow ","\x26#8658;");a.longleftrightarrow=b(c,"\\longleftrightarrow ","\x26#8596;");a.updownarrow=b(c,"\\updownarrow ","\x26#8597;");a.Longleftrightarrow=
b(c,"\\Longleftrightarrow ","\x26#8660;");a.Updownarrow=b(c,"\\Updownarrow ","\x26#8661;");a.mapsto=b(c,"\\mapsto ","\x26#8614;");a.nearrow=b(c,"\\nearrow ","\x26#8599;");a.hookleftarrow=b(c,"\\hookleftarrow ","\x26#8617;");a.hookrightarrow=b(c,"\\hookrightarrow ","\x26#8618;");a.searrow=b(c,"\\searrow ","\x26#8600;");a.leftharpoonup=b(c,"\\leftharpoonup ","\x26#8636;");a.rightharpoonup=b(c,"\\rightharpoonup ","\x26#8640;");a.swarrow=b(c,"\\swarrow ","\x26#8601;");a.leftharpoondown=b(c,"\\leftharpoondown ",
"\x26#8637;");a.rightharpoondown=b(c,"\\rightharpoondown ","\x26#8641;");a.nwarrow=b(c,"\\nwarrow ","\x26#8598;");a.ldots=b(c,"\\ldots ","\x26#8230;");a.cdots=b(c,"\\cdots ","\x26#8943;");a.vdots=b(c,"\\vdots ","\x26#8942;");a.ddots=b(c,"\\ddots ","\x26#8944;");a.surd=b(c,"\\surd ","\x26#8730;");a.triangle=b(c,"\\triangle ","\x26#9653;");a.ell=b(c,"\\ell ","\x26#8467;");a.top=b(c,"\\top ","\x26#8868;");a.flat=b(c,"\\flat ","\x26#9837;");a.natural=b(c,"\\natural ","\x26#9838;");a.sharp=b(c,"\\sharp ",
"\x26#9839;");a.wp=b(c,"\\wp ","\x26#8472;");a.bot=b(c,"\\bot ","\x26#8869;");a.clubsuit=b(c,"\\clubsuit ","\x26#9827;");a.diamondsuit=b(c,"\\diamondsuit ","\x26#9826;");a.heartsuit=b(c,"\\heartsuit ","\x26#9825;");a.spadesuit=b(c,"\\spadesuit ","\x26#9824;");a.oint=b(c,"\\oint ","\x26#8750;");a.bigcap=b(c,"\\bigcap ","\x26#8745;");a.bigcup=b(c,"\\bigcup ","\x26#8746;");a.bigsqcup=b(c,"\\bigsqcup ","\x26#8852;");a.bigvee=b(c,"\\bigvee ","\x26#8744;");a.bigwedge=b(c,"\\bigwedge ","\x26#8743;");a.bigodot=
b(c,"\\bigodot ","\x26#8857;");a.bigotimes=b(c,"\\bigotimes ","\x26#8855;");a.bigoplus=b(c,"\\bigoplus ","\x26#8853;");a.biguplus=b(c,"\\biguplus ","\x26#8846;");a.lfloor=b(c,"\\lfloor ","\x26#8970;");a.rfloor=b(c,"\\rfloor ","\x26#8971;");a.lceil=b(c,"\\lceil ","\x26#8968;");a.rceil=b(c,"\\rceil ","\x26#8969;");a.slash=b(c,"\\slash ","\x26#47;");a.opencurlybrace=b(c,"\\opencurlybrace ","\x26#123;");a.closecurlybrace=b(c,"\\closecurlybrace ","\x26#125;");a.caret=b(c,"\\caret ","^");a.underscore=b(c,
"\\underscore ","_");a.backslash=b(c,"\\backslash ","\\");a.vert=b(c,"|");a.perp=a.perpendicular=b(c,"\\perp ","\x26perp;");a.nabla=a.del=b(c,"\\nabla ","\x26nabla;");a.hbar=b(c,"\\hbar ","\x26#8463;");a.AA=a.Angstrom=a.angstrom=b(c,"\\text\\AA ","\x26#8491;");a.ring=a.circ=a.circle=b(c,"\\circ ","\x26#8728;");a.bull=a.bullet=b(c,"\\bullet ","\x26bull;");a.setminus=a.smallsetminus=b(c,"\\setminus ","\x26#8726;");a.not=a["¬"]=a.neg=b(c,"\\neg ","\x26not;");a["…"]=a.dots=a.ellip=a.hellip=a.ellipsis=
a.hellipsis=b(c,"\\dots ","\x26hellip;");a.converges=a.darr=a.dnarr=a.dnarrow=a.downarrow=b(c,"\\downarrow ","\x26darr;");a.dArr=a.dnArr=a.dnArrow=a.Downarrow=b(c,"\\Downarrow ","\x26dArr;");a.diverges=a.uarr=a.uparrow=b(c,"\\uparrow ","\x26uarr;");a.uArr=a.Uparrow=b(c,"\\Uparrow ","\x26uArr;");a.to=b(k,"\\to ","\x26rarr;");a.rarr=a.rightarrow=b(c,"\\rightarrow ","\x26rarr;");a.implies=b(k,"\\Rightarrow ","\x26rArr;");a.rArr=a.Rightarrow=b(c,"\\Rightarrow ","\x26rArr;");a.gets=b(k,"\\gets ","\x26larr;");
a.larr=a.leftarrow=b(c,"\\leftarrow ","\x26larr;");a.impliedby=b(k,"\\Leftarrow ","\x26lArr;");a.lArr=a.Leftarrow=b(c,"\\Leftarrow ","\x26lArr;");a.harr=a.lrarr=a.leftrightarrow=b(c,"\\leftrightarrow ","\x26harr;");a.iff=b(k,"\\Leftrightarrow ","\x26hArr;");a.hArr=a.lrArr=a.Leftrightarrow=b(c,"\\Leftrightarrow ","\x26hArr;");a.Re=a.Real=a.real=b(c,"\\Re ","\x26real;");a.Im=a.imag=a.image=a.imagin=a.imaginary=a.Imaginary=b(c,"\\Im ","\x26image;");a.part=a.partial=b(c,"\\partial ","\x26part;");a.inf=
a.infin=a.infty=a.infinity=b(c,"\\infty ","\x26infin;");a.alef=a.alefsym=a.aleph=a.alephsym=b(c,"\\aleph ","\x26alefsym;");a.xist=a.xists=a.exist=a.exists=b(c,"\\exists ","\x26exist;");a.and=a.land=a.wedge=b(c,"\\wedge ","\x26and;");a.or=a.lor=a.vee=b(c,"\\vee ","\x26or;");a.o=a.O=a.empty=a.emptyset=a.oslash=a.Oslash=a.nothing=a.varnothing=b(k,"\\varnothing ","\x26empty;");a.cup=a.union=b(k,"\\cup ","\x26cup;");a.cap=a.intersect=a.intersection=b(k,"\\cap ","\x26cap;");a.deg=a.degree=b(c,"^\\circ ",
"\x26deg;");a.ang=a.angle=b(c,"\\angle ","\x26ang;");var Z=g(D,function(a,b){a.init=function(a){b.init.call(this,"\\"+a+" ","\x3cspan\x3e"+a+"\x3c/span\x3e")};a.respace=function(){this.jQ[0].className=this.next instanceof B||this.next instanceof K?"":"non-italicized-function"}});a.ln=a.lg=a.log=a.span=a.proj=a.det=a.dim=a.min=a.max=a.mod=a.lcm=a.gcd=a.gcf=a.hcf=a.lim=Z;(function(){var b="sin cos tan sec cosec csc cotan cot".split(" "),c;for(c in b)a[b[c]]=a[b[c]+"h"]=a["a"+b[c]]=a["arc"+b[c]]=a["a"+
b[c]+"h"]=a["arc"+b[c]+"h"]=Z})();var F=function(){function b(a){for(var d=a[0]||A(),c=1;c<a.length;c+=1)a[c].children().adopt(d,d.lastChild,0);return d}var g=p.string,e=p.regex,d=p.any,n=p.optWhitespace,y=p.succeed,h=p.fail,k=p.letter.map(v),l=e(/^[^${}\\_^]/).map(c),e=e(/^[^\\]/).or(g("\\").then(e(/^[a-z]+/i).or(e(/^\s+/).result(" ")).or(d))).then(function(b){var d=a[b];return d?d(b).parser():h("unknown command: \\"+b)}).or(k).or(l),d=g("{").then(function(){return m}).skip(g("}")),e=n.then(d.or(e.map(function(a){var b=
A();a.adopt(b,0,0);return b}))),m=e.many().map(b).skip(n),g=g("[").then(e.then(function(a){return"]"!==a.join("latex")?y(a):h()}).many().map(b).skip(n)).skip(g("]")),n=m;n.block=e;n.optBlock=g;return n}(),aa=g(function(b){function g(a,b){if(a.next[b])a.prependTo(a.next[b]);else if(a.prev[b])a.appendTo(a.prev[b]);else{var c=a.parent;do{var h=c[b];if(h&&("function"===typeof h&&(h=c[b](a)),!1===h||h instanceof A)){a.upDownCache[c.id]={parent:a.parent,prev:a.prev,next:a.next};h instanceof A&&((c=a.upDownCache[h.id])?
c.next?a.insertBefore(c.next):a.appendTo(c.parent):(c=e(a).left,a.appendTo(h),a.seekHoriz(c,h)));break}c=c.parent.parent}while(c)}return a.clearSelection().show()}function e(a){var b=a.jQ.removeClass("cursor").offset();a.jQ.addClass("cursor");return b}b.init=function(a){this.parent=this.root=a;var b=this.jQ=this._jQ=m('\x3cspan class\x3d"cursor"\x3e\x26zwj;\x3c/span\x3e');this.blink=function(){b.toggleClass("blink")};this.upDownCache={}};b.prev=0;b.next=0;b.parent=0;b.show=function(){this.jQ=this._jQ.removeClass("blink");
"intervalId"in this?clearInterval(this.intervalId):(this.next?this.selection&&this.selection.first.prev===this.prev?this.jQ.insertBefore(this.selection.jQ):this.jQ.insertBefore(this.next.jQ.first()):this.jQ.appendTo(this.parent.jQ),this.parent.focus());this.intervalId=setInterval(this.blink,500);return this};b.hide=function(){"intervalId"in this&&clearInterval(this.intervalId);delete this.intervalId;this.jQ.detach();this.jQ=m();return this};b.insertAt=function(a,b,c){var e=this.parent;this.parent=
a;this.prev=b;this.next=c;e.blur()};b.insertBefore=function(a){this.insertAt(a.parent,a.prev,a);this.parent.jQ.addClass("hasCursor");this.jQ.insertBefore(a.jQ.first());return this};b.insertAfter=function(a){this.insertAt(a.parent,a,a.next);this.parent.jQ.addClass("hasCursor");this.jQ.insertAfter(a.jQ.last());return this};b.prependTo=function(a){this.insertAt(a,0,a.firstChild);a.textarea?this.jQ.insertAfter(a.textarea):this.jQ.prependTo(a.jQ);a.focus();return this};b.appendTo=function(a){this.insertAt(a,
a.lastChild,0);this.jQ.appendTo(a.jQ);a.focus();return this};b.hopLeft=function(){this.jQ.insertBefore(this.prev.jQ.first());this.next=this.prev;this.prev=this.prev.prev;return this};b.hopRight=function(){this.jQ.insertAfter(this.next.jQ.last());this.prev=this.next;this.next=this.next.next;return this};b.moveLeftWithin=function(a){this.prev?this.prev.lastChild?this.appendTo(this.prev.lastChild):this.hopLeft():this.parent!==a&&(this.parent.prev?this.appendTo(this.parent.prev):this.insertBefore(this.parent.parent))};
b.moveRightWithin=function(a){this.next?this.next.firstChild?this.prependTo(this.next.firstChild):this.hopRight():this.parent!==a&&(this.parent.next?this.prependTo(this.parent.next):this.insertAfter(this.parent.parent))};b.moveLeft=function(){this.upDownCache={};this.selection?this.insertBefore(this.selection.first).clearSelection():this.moveLeftWithin(this.root);return this.show()};b.moveRight=function(){this.upDownCache={};this.selection?this.insertAfter(this.selection.last).clearSelection():this.moveRightWithin(this.root);
return this.show()};b.moveUp=function(){return g(this,"up")};b.moveDown=function(){return g(this,"down")};b.seek=function(a,b,c){this.upDownCache={};var e,f=this.clearSelection().show();if(a.hasClass("empty"))return f.prependTo(q[a.attr("mathquill-block-id")]),f;c=q[a.attr("mathquill-command-id")];if(c instanceof D)return a.outerWidth()>2*(b-a.offset().left)?f.insertBefore(c):f.insertAfter(c),f;c||(e=q[a.attr("mathquill-block-id")],e||(a=a.parent(),c=q[a.attr("mathquill-command-id")],c||(e=q[a.attr("mathquill-block-id")],
e||(e=f.root))));c?f.insertAfter(c):f.appendTo(e);return f.seekHoriz(b,f.root)};b.seekHoriz=function(a,b){var c=e(this).left-a,f;do this.moveLeftWithin(b),f=c,c=e(this).left-a;while(0<c&&(this.prev||this.parent!==b));-c>f&&this.moveRightWithin(b);return this};b.writeLatex=function(a){this.upDownCache={};this.show().deleteSelection();var b=p.all;if(a=F.skip(p.eof).or(b.result(!1)).parse(a))a.children().adopt(this.parent,this.prev,this.next),q.jQize(a.join("html")).insertBefore(this.jQ),this.prev=a.lastChild,
a.finalizeInsert(),this.parent.bubble("redraw");return this.hide()};b.write=function(a){this.upDownCache={};return this.show().insertCh(a)};b.insertCh=function(b){var e;e=b.match(/^[a-eg-zA-Z]$/)?v(b):(e=r[b]||a[b])?e(b):c(b);this.selection&&(this.prev=this.selection.first.prev,this.next=this.selection.last.next,e.replaces(this.selection),delete this.selection);return this.insertNew(e)};b.insertNew=function(a){a.createBefore(this);return this};b.insertCmd=function(b,c){var e=a[b];e?(e=e(b),c&&e.replaces(c),
this.insertNew(e)):(e=J(),e.replaces(b),e.firstChild.focus=function(){delete this.focus;return this},this.insertNew(e).insertAfter(e),c&&c.remove());return this};b.unwrapGramp=function(){var a=this.parent.parent,b=a.parent,c=a.next,e=a.prev;a.disown().eachChild(function(f){f.isEmpty()||(f.children().adopt(b,e,c).each(function(b){b.jQ.insertBefore(a.jQ.first())}),e=f.lastChild)});if(!this.next)if(this.prev)this.next=this.prev.next;else for(;!this.next;)if(this.parent=this.parent.next)this.next=this.parent.firstChild;
else{this.next=a.next;this.parent=b;break}this.next?this.insertBefore(this.next):this.appendTo(b);a.jQ.remove();a.prev&&a.prev.respace();a.next&&a.next.respace()};b.backspace=function(){this.upDownCache={};this.show();if(!this.deleteSelection())if(this.prev)this.prev.isEmpty()?this.prev=this.prev.remove().prev:this.selectLeft();else if(this.parent!==this.root){if(this.parent.parent.isEmpty())return this.insertAfter(this.parent.parent).backspace();this.unwrapGramp()}this.prev&&this.prev.respace();
this.next&&this.next.respace();this.parent.bubble("redraw");return this};b.deleteForward=function(){this.upDownCache={};this.show();if(!this.deleteSelection())if(this.next)this.next.isEmpty()?this.next=this.next.remove().next:this.selectRight();else if(this.parent!==this.root){if(this.parent.parent.isEmpty())return this.insertBefore(this.parent.parent).deleteForward();this.unwrapGramp()}this.prev&&this.prev.respace();this.next&&this.next.respace();this.parent.bubble("redraw");return this};b.selectFrom=
function(a){var b=this,c=a;a:for(;;){for(var e=this;e!==b.parent.parent;e=e.parent.parent)if(e.parent===c.parent){a=e;break a}for(e=a;e!==c.parent.parent;e=e.parent.parent)if(b.parent===e.parent){a=b;c=e;break a}b.parent.parent&&(b=b.parent.parent);c.parent.parent&&(c=c.parent.parent)}var f;if(a.next!==c){for(b=a;b;b=b.next)if(b===c.prev){f=!0;break}f||(f=c,c=a,a=f)}this.hide().selection=V(a.prev.next||a.parent.firstChild,c.next.prev||c.parent.lastChild);this.insertAfter(c.next.prev||c.parent.lastChild);
this.root.selectionChanged()};b.selectLeft=function(){this.upDownCache={};if(this.selection)if(this.selection.first===this.next)this.prev?this.hopLeft().selection.extendLeft():this.parent!==this.root&&this.insertBefore(this.parent.parent).selection.levelUp();else{this.hopLeft();if(this.selection.first===this.selection.last){this.clearSelection().show();return}this.selection.retractLeft()}else{if(this.prev)this.hopLeft();else if(this.parent!==this.root)this.insertBefore(this.parent.parent);else return;
this.hide().selection=V(this.next)}this.root.selectionChanged()};b.selectRight=function(){this.upDownCache={};if(this.selection)if(this.selection.last===this.prev)this.next?this.hopRight().selection.extendRight():this.parent!==this.root&&this.insertAfter(this.parent.parent).selection.levelUp();else{this.hopRight();if(this.selection.first===this.selection.last){this.clearSelection().show();return}this.selection.retractRight()}else{if(this.next)this.hopRight();else if(this.parent!==this.root)this.insertAfter(this.parent.parent);
else return;this.hide().selection=V(this.prev)}this.root.selectionChanged()};b.prepareMove=function(){this.upDownCache={};return this.show().clearSelection()};b.prepareEdit=function(){this.upDownCache={};return this.show().deleteSelection()};b.clearSelection=function(){this.selection&&(this.selection.clear(),delete this.selection,this.root.selectionChanged());return this};b.deleteSelection=function(){if(!this.selection)return!1;this.prev=this.selection.first.prev;this.next=this.selection.last.next;
this.selection.remove();this.root.selectionChanged();return delete this.selection}}),V=g(M,function(a,b){a.init=function(){b.init.apply(this,arguments);this.jQwrap(this.jQ)};a.jQwrap=function(a){this.jQ=a.wrapAll('\x3cspan class\x3d"selection"\x3e\x3c/span\x3e').parent()};a.adopt=function(){this.jQ.replaceWith(this.jQ=this.jQ.children());return b.adopt.apply(this,arguments)};a.clear=function(){this.jQ.replaceWith(this.jQ.children());return this};a.levelUp=function(){var a=this.first=this.last=this.last.parent.parent;
this.clear().jQwrap(a.jQ);return this};a.extendLeft=function(){this.first=this.first.prev;this.first.jQ.prependTo(this.jQ)};a.extendRight=function(){this.last=this.last.next;this.last.jQ.appendTo(this.jQ)};a.retractRight=function(){this.first.jQ.insertBefore(this.jQ);this.first=this.first.next};a.retractLeft=function(){this.last.jQ.insertAfter(this.jQ);this.last=this.last.prev}});m.fn.mathquill=function(a,b){switch(a){case "redraw":return this.each(function(){var a=m(this).attr("mathquill-block-id");
(a=a&&q[a])&&function C(a){a.eachChild(C);a.redraw&&a.redraw()}(a)});case "revert":return this.each(function(){var a=m(this).attr("mathquill-block-id");(a=a&&q[a])&&a.revert&&a.revert()});case "latex":if(1<arguments.length)return this.each(function(){var a=m(this).attr("mathquill-block-id");(a=a&&q[a])&&a.renderLatex(b)});var c=m(this).attr("mathquill-block-id");return(c=c&&q[c])&&c.latex();case "text":return(c=(c=m(this).attr("mathquill-block-id"))&&q[c])&&c.text();case "html":return this.html().replace(/ ?hasCursor|hasCursor /,
"").replace(/ class=(""|(?= |>))/g,"").replace(/<span class="?cursor( blink)?"?><\/span>/i,"").replace(/<span class="?textarea"?><textarea><\/textarea><\/span>/i,"");case "write":if(1<arguments.length)return this.each(function(){var a=m(this).attr("mathquill-block-id");(a=(a=a&&q[a])&&a.cursor)&&a.writeLatex(b).parent.blur()});case "cmd":if(1<arguments.length)return this.each(function(){var a=m(this).attr("mathquill-block-id");if(a=(a=a&&q[a])&&a.cursor){a.show();if(/^\\[a-z]+$/i.test(b)){var c=a.selection;
c&&(a.prev=c.first.prev,a.next=c.last.next,delete a.selection);a.insertCmd(b.slice(1),c)}else a.insertCh(b);a.hide().parent.blur()}});default:var d="textbox"===a,g=d||"editable"===a,k=d?ca:N;return this.each(function(){W(m(this),k(),d,g)})}};m(function(){m(".mathquill-editable:not(.mathquill-rendered-math)").mathquill("editable");m(".mathquill-textbox:not(.mathquill-rendered-math)").mathquill("textbox");m(".mathquill-embedded-latex").mathquill()})})();