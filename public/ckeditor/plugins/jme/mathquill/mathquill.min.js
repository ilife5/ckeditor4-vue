(function(){function C(){}function b(a){var b=S.call(arguments,1);return function(){return a.apply(this,b)}}function y(a,b){if(!b)throw Error("prayer failed: "+a);}function ba(a,b,e,d){function n(){var a;w=T;a=h.selection?"$"+h.selection.latex()+"$":"";k.select(a)}var h,v,c,w,g,ca,k,l=a.contents().detach();e||a.addClass("mathquill-rendered-math");b.jQ=a.attr(z,b.id);b.revert=function(){a.empty().unbind(".mathquill").removeClass("mathquill-rendered-math mathquill-editable mathquill-textbox").append(l)};
h=b.cursor=da(b);b.renderLatex(l.text());v=b.textarea=p('\x3cspan class\x3d"textarea"\x3e\x3ctextarea\x3e\x3c/textarea\x3e\x3c/span\x3e');c=v.children();b.selectionChanged=function(){w===T&&(w=setTimeout(n));V(a[0])};a.bind("selectstart.mathquill",function(a){a.target!==c[0]&&a.preventDefault();a.stopPropagation()});ca=h.blink;a.bind("mousedown.mathquill",function(e){function b(a){return h.seek(p(a.target),a.pageX,a.pageY),(h.prev!==g.prev||h.parent!==g.parent)&&h.selectFrom(g),!1}function n(a){return delete a.target,
b(a)}function u(e){g=T;h.blink=ca;h.selection||(d?h.show():v.detach());a.unbind("mousemove",b);p(e.target.ownerDocument).unbind("mousemove",n).unbind("mouseup",u)}return setTimeout(function(){c.focus()}),h.blink=C,h.seek(p(e.target),e.pageX,e.pageY),g={parent:h.parent,prev:h.prev,next:h.next},d||a.prepend(v),a.mousemove(b),p(e.target.ownerDocument).mousemove(n).mouseup(u),!1});if(d)k=W(c,{container:a,key:function(a,e){h.parent.bubble("onKey",a,e)},text:function(a){h.parent.bubble("onText",a)},cut:function(a){h.selection&&
setTimeout(function(){h.prepareEdit();h.parent.bubble("redraw")});a.stopPropagation()},paste:function(a){"$"===a.slice(0,1)&&"$"===a.slice(-1)?a=a.slice(1,-1):a="\\text{"+a+"}";h.writeLatex(a).show()}}),a.prepend(v),a.addClass("mathquill-editable"),e&&a.addClass("mathquill-textbox"),c.focus(function(a){h.parent||h.appendTo(b);h.parent.jQ.addClass("hasCursor");h.selection?(h.selection.jQ.removeClass("blur"),setTimeout(b.selectionChanged)):h.show();a.stopPropagation()}).blur(function(a){h.hide().parent.blur();
h.selection&&h.selection.jQ.addClass("blur");a.stopPropagation()}),a.bind("focus.mathquill blur.mathquill",function(a){c.trigger(a)}).blur();else{var q=function(){v.detach()};k=W(c,{container:a});a.bind("cut paste",!1).bind("copy",n).prepend('\x3cspan class\x3d"selectable"\x3e$'+b.latex()+"$\x3c/span\x3e");c.blur(function(){h.clearSelection();setTimeout(q)})}}function G(a,b,e){return g(I,{ctrlSeq:a,htmlTemplate:"\x3c"+b+" "+e+"\x3e\x260\x3c/"+b+"\x3e"})}var T,g,W,q,P,L,ea,m,t,D,A,M,N,Q,fa,r,a,J,V,
l,E,X,Y,B,ga,ha,K,O,I,ia,x,c,k,H,Z,F,da,R,p=jQuery,z="mathquill-block-id",aa=Math.min,S=[].slice;g=function(a,b,e){return function(d,n){function h(a){if(!(this instanceof h))return new h(arguments);a&&"function"==typeof this.init&&this.init.apply(this,a)}n===e&&(n=d,d=Object);var c=h[a]=new d,U=d[a],w,g=h.mixin=function(a){w={};"function"==typeof a?w=a.call(h,c,U,h,d):"object"==typeof a&&(w=a);if("object"==typeof w)for(var e in w)b.call(w,e)&&(c[e]=w[e]);return"function"==typeof c.init||(c.init=function(){d.apply(this,
arguments)}),h};return c.constructor=h,g(n)}}("prototype",{}.hasOwnProperty);W=function(){function a(e){var d=e.which||e.keyCode,f=b[d],h,c=[];return e.ctrlKey&&c.push("Ctrl"),e.originalEvent&&e.originalEvent.metaKey&&c.push("Meta"),e.altKey&&c.push("Alt"),e.shiftKey&&c.push("Shift"),h=f||String.fromCharCode(d),c.length||f?(c.push(h),c.join("-")):h}var b={8:"Backspace",9:"Tab",10:"Enter",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Esc",32:"Spacebar",33:"PageUp",34:"PageDown",35:"End",
36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Del",144:"NumLock"};return function(e,d){function b(a){var e=m.val();m.val("");e&&a(e)}function h(){var a=m[0];"selectionStart"in a&&a.selectionStart!==a.selectionEnd||b(g)}function c(){b(l)}var u=null,w=null;d||(d={});var g=d.text||C,k=d.key||C,l=d.paste||C,q=d.cut||C,m=p(e),t=p(d.container||m),r=C;return t.bind("keydown keypress input keyup focusout paste",function(){r()}),t.bind({keydown:function(e){u=e;w=null;k(a(u),u)},keypress:function(e){u&&
w&&k(a(u),u);w=e;r=h;setTimeout(h)},focusout:function(){u=w=null},cut:q,paste:function(a){m.focus();r=c;setTimeout(c)}}),{select:function(a){r();m.val(a);a&&m[0].select()}}}}();q=g(function(a,b,e){function d(a,e){throw a?a="'"+a+"'":a="EOF","Parse Error: "+e+" at "+a;}a.init=function(a){this._=a};a.parse=function(a){return this.skip(h)._(a,function(a,e){return e},d)};a.or=function(a){y("or is passed a parser",a instanceof e);var d=this;return e(function(e,f,b){return d._(e,f,function(d){return a._(e,
f,b)})})};a.then=function(a){var d=this;return e(function(f,b,n){return d._(f,function(d,f){var h=a instanceof e?a:a(f);return y("a parser is returned",h instanceof e),h._(d,b,n)},n)})};a.many=function(){var a=this;return e(function(e,d,f){function b(a,d){return e=a,h.push(d),!0}function n(){return!1}for(var h=[];a._(e,b,n););return d(e,h)})};a.times=function(a,d){2>arguments.length&&(d=a);var f=this;return e(function(e,b,n){function h(a,d){return g.push(d),e=a,!0}function c(a,d){return l=d,e=a,!1}
function u(a,e){return!1}for(var g=[],k=!0,l,m=0;m<a;m+=1)if(k=f._(e,h,c),!k)return n(e,l);for(;m<d&&k;m+=1)k=f._(e,h,u);return b(e,g)})};a.result=function(a){return this.then(n(a))};a.atMost=function(a){return this.times(0,a)};a.atLeast=function(a){var e=this;return e.times(a).then(function(a){return e.many().map(function(e){return a.concat(e)})})};a.map=function(a){return this.then(function(e){return n(a(e))})};a.skip=function(a){return this.then(function(e){return a.result(e)})};this.string=function(a){var d=
a.length,f="expected '"+a+"'";return e(function(e,b,n){var h=e.slice(0,d);return h===a?b(e.slice(d),h):n(e,f)})};a=this.regex=function(a){y("regexp parser is anchored","^"===a.toString().charAt(1));var d="expected "+a;return e(function(e,f,b){var n=a.exec(e);return n?(b=n[0],f(e.slice(b.length),b)):b(e,d)})};var n=e.succeed=function(a){return e(function(e,d){return d(e,a)})};e.fail=function(a){return e(function(e,d,f){return f(e,a)})};e.letter=a(/^[a-z]/i);e.letters=a(/^[a-z]*/i);e.digit=a(/^[0-9]/);
e.digits=a(/^[0-9]*/);e.whitespace=a(/^\s+/);e.optWhitespace=a(/^\s*/);e.any=e(function(a,e,d){return a?e(a.slice(1),a.charAt(0)):d(a,"expected any character")});e.all=e(function(a,e,d){return e("",a)});var h=e.eof=e(function(a,e,d){return a?d(a,"expected EOF"):e(a,a)})});P=g(function(a){a.prev=0;a.next=0;a.parent=0;a.firstChild=0;a.lastChild=0;a.children=function(){return L(this.firstChild,this.lastChild)};a.eachChild=function(a){return this.children().each(a)};a.foldChildren=function(a,e){return this.children().fold(a,
e)};a.adopt=function(a,e,d){return L(this,this).adopt(a,e,d),this};a.disown=function(){return L(this,this).disown(),this}});L=g(function(a){function b(a,d,f){y("a parent is always present",a);y("prev is properly set up",d?d.next===f&&d.parent===a:a.firstChild===f);y("next is properly set up",f?f.prev===d&&f.parent===a:a.lastChild===d)}a.first=0;a.last=0;a.init=function(a,d){y("no half-empty fragments",!a==!d);a&&(y("first node is passed to Fragment",a instanceof P),y("last node is passed to Fragment",
d instanceof P),y("first and last have the same parent",a.parent===d.parent),this.first=a,this.last=d)};a.adopt=function(a,d,f){b(a,d,f);this.disowned=!1;var h=this.first;if(!h)return this;var c=this.last;return d||(a.firstChild=h),f?f.prev=c:a.lastChild=c,this.last.next=f,this.each(function(f){f.prev=d;f.parent=a;d&&(d.next=f);d=f}),this};a.disown=function(){var a=this.first;if(!a||this.disowned)return this;this.disowned=!0;var d=this.last,f=a.parent;return b(f,a.prev,a),b(f,d,d.next),a.prev?a.prev.next=
d.next:f.firstChild=d.next,d.next?d.next.prev=a.prev:f.lastChild=a.prev,this};a.each=function(a){var d=this.first;if(!d)return this;for(;d!==this.last.next&&!1!==a.call(this,d);d=d.next);return this};a.fold=function(a,d){return this.each(function(f){a=d.call(this,a,f)}),a}});ea=function(){var a=0;return function(){return a+=1}}();m=g(P,function(a){a.init=function(a){this.id=ea();m[this.id]=this};a.toString=function(){return"[MathElement "+this.id+"]"};a.bubble=function(a){for(var e=S.call(arguments,
1),d=this;d&&!1!==(d[a]&&d[a].apply(d,e));d=d.parent);return this};a.postOrder=function(a){S.call(arguments,1);if("string"==typeof a){var e=a;a=function(a){e in a&&a[e].apply(a,arguments)}}(function n(e){e.eachChild(n);a(e)})(this)};a.jQ=p();a.jQadd=function(a){this.jQ=this.jQ.add(a)};this.jQize=function(a){a=p(a);return a.find("*").andSelf().each(function(){var a=p(this),d=a.attr("mathquill-command-id"),f=a.attr("mathquill-block-id");d&&m[d].jQadd(a);f&&m[f].jQadd(a)}),a};a.finalizeInsert=function(){this.postOrder("finalizeTree");
this.postOrder("blur");this.postOrder("respace");this.next.respace&&this.next.respace();this.prev.respace&&this.prev.respace();this.postOrder("redraw");this.bubble("redraw")}});t=g(m,function(a,b){a.init=function(a,d,f){b.init.call(this);this.ctrlSeq||(this.ctrlSeq=a);d&&(this.htmlTemplate=d);f&&(this.textTemplate=f)};a.replaces=function(a){a.disown();this.replacedFragment=a};a.isEmpty=function(){return this.foldChildren(!0,function(a,d){return a&&d.isEmpty()})};a.parser=function(){var a=this;return F.block.times(a.numBlocks()).map(function(d){a.blocks=
d;for(var f=0;f<d.length;f+=1)d[f].adopt(a,a.lastChild,0);return a})};a.createBefore=function(a){var d=this.replacedFragment;this.createBlocks();m.jQize(this.html());d&&(d.adopt(this.firstChild,0,0),d.jQ.appendTo(this.firstChild.jQ));a.jQ.before(this.jQ);a.prev=this.adopt(a.parent,a.prev,a.next);this.finalizeInsert(a);this.placeCursor(a)};a.createBlocks=function(){for(var a=this.numBlocks(),d=this.blocks=Array(a),f=0;f<a;f+=1)(d[f]=A()).adopt(this,this.lastChild,0)};a.respace=C;a.placeCursor=function(a){a.appendTo(this.foldChildren(this.firstChild,
function(a,e){return a.isEmpty()?a:e}))};a.remove=function(){return this.disown(),this.jQ.remove(),this.postOrder(function(a){delete m[a.id]}),this};a.numBlocks=function(){var a=this.htmlTemplate.match(/&\d+/g);return a?a.length:0};a.html=function(){var a=this.blocks,d=" mathquill-command-id\x3d"+this.id,f=this.htmlTemplate.match(/<[^<>]+>|[^<>]+/g);y("no unmatched angle brackets",f.join("")===this.htmlTemplate);for(var b=0,c=f[0];c;b+=1,c=f[b])if("/\x3e"===c.slice(-2))f[b]=c.slice(0,-2)+d+"/\x3e";
else if("\x3c"===c.charAt(0)){y("not an unmatched top-level close tag","/"!==c.charAt(1));f[b]=c.slice(0,-1)+d+"\x3e";var u=1;do b+=1,c=f[b],y("no missing close tags",c),"\x3c/"===c.slice(0,2)?--u:"\x3c"===c.charAt(0)&&"/\x3e"!==c.slice(-2)&&(u+=1);while(0<u)}return f.join("").replace(/>&(\d+)/g,function(d,f){return" mathquill-block-id\x3d"+a[f].id+"\x3e"+a[f].join("html")})};a.latex=function(){return this.foldChildren(this.ctrlSeq,function(a,d){return a+"{"+(d.latex()||" ")+"}"})};a.textTemplate=
[""];a.text=function(){var a=0;return this.foldChildren(this.textTemplate[a],function(d,f){a+=1;var b=f.text();return d&&"("===this.textTemplate[a]&&"("===b[0]&&")"===b.slice(-1)?d+b.slice(1,-1)+this.textTemplate[a]:d+f.text()+(this.textTemplate[a]||"")})}});D=g(t,function(a,b){a.init=function(a,d,f){f||(f=a&&1<a.length?a.slice(1):a);b.init.call(this,a,d,[f])};a.parser=function(){return q.succeed(this)};a.numBlocks=function(){return 0};a.replaces=function(a){a.remove()};a.createBlocks=C;a.latex=function(){return this.ctrlSeq};
a.text=function(){return this.textTemplate};a.placeCursor=C;a.isEmpty=function(){return!0}});A=g(m,function(a){a.join=function(a){return this.foldChildren("",function(e,d){return e+d[a]()})};a.latex=function(){return this.join("latex")};a.text=function(){return this.firstChild===this.lastChild?this.firstChild.text():"("+this.join("text")+")"};a.isEmpty=function(){return 0===this.firstChild&&0===this.lastChild};a.focus=function(){return this.jQ.addClass("hasCursor"),this.jQ.removeClass("empty"),this};
a.blur=function(){return this.jQ.removeClass("hasCursor"),this.isEmpty()&&this.jQ.addClass("empty"),this}});M=g(L,function(a,b){a.init=function(a,d){b.init.call(this,a,d||a);this.jQ=this.fold(p(),function(a,d){return d.jQ.add(a)})};a.latex=function(){return this.fold("",function(a,d){return a+d.latex()})};a.remove=function(){return this.jQ.remove(),this.each(function(a){a.postOrder(function(a){delete m[a.id]})}),this.disown()}});N=g(A,function(a,b){a.latex=function(){return b.latex.call(this).replace(/(\\[a-z]+) (?![a-z])/ig,
"$1")};a.text=function(){return this.foldChildren("",function(a,d){return a+d.text()})};a.renderLatex=function(a){this.jQ.children().slice(1).remove();this.firstChild=this.lastChild=0;this.cursor.appendTo(this).writeLatex(a)};a.onKey=function(a,d){switch(a){case "Ctrl-Shift-Backspace":case "Ctrl-Backspace":for(;this.cursor.prev||this.cursor.selection;)this.cursor.backspace();break;case "Shift-Backspace":case "Backspace":this.cursor.backspace();break;case "Esc":case "Tab":case "Spacebar":var b=this.cursor.parent;
if(b===this.cursor.root){"Spacebar"===a&&d.preventDefault();return}this.cursor.prepareMove();b.next?this.cursor.prependTo(b.next):this.cursor.insertAfter(b.parent);break;case "Shift-Tab":case "Shift-Esc":case "Shift-Spacebar":b=this.cursor.parent;if(b===this.cursor.root){"Shift-Spacebar"===a&&d.preventDefault();return}this.cursor.prepareMove();b.prev?this.cursor.appendTo(b.prev):this.cursor.insertBefore(b.parent);break;case "Enter":break;case "End":this.cursor.prepareMove().appendTo(this.cursor.parent);
break;case "Ctrl-End":this.cursor.prepareMove().appendTo(this);break;case "Shift-End":for(;this.cursor.next;)this.cursor.selectRight();break;case "Ctrl-Shift-End":for(;this.cursor.next||this.cursor.parent!==this;)this.cursor.selectRight();break;case "Home":this.cursor.prepareMove().prependTo(this.cursor.parent);break;case "Ctrl-Home":this.cursor.prepareMove().prependTo(this);break;case "Shift-Home":for(;this.cursor.prev;)this.cursor.selectLeft();break;case "Ctrl-Shift-Home":for(;this.cursor.prev||
this.cursor.parent!==this;)this.cursor.selectLeft();break;case "Left":this.cursor.moveLeft();break;case "Shift-Left":this.cursor.selectLeft();break;case "Ctrl-Left":break;case "Right":this.cursor.moveRight();break;case "Shift-Right":this.cursor.selectRight();break;case "Ctrl-Right":break;case "Up":this.cursor.moveUp();break;case "Down":this.cursor.moveDown();break;case "Shift-Up":if(this.cursor.prev)for(;this.cursor.prev;)this.cursor.selectLeft();else this.cursor.selectLeft();case "Shift-Down":if(this.cursor.next)for(;this.cursor.next;)this.cursor.selectRight();
else this.cursor.selectRight();case "Ctrl-Up":break;case "Ctrl-Down":break;case "Ctrl-Shift-Del":case "Ctrl-Del":for(;this.cursor.next||this.cursor.selection;)this.cursor.deleteForward();break;case "Shift-Del":case "Del":this.cursor.deleteForward();break;case "Meta-A":case "Ctrl-A":if(this!==this.cursor.root)return;for(this.cursor.prepareMove().appendTo(this);this.cursor.prev;)this.cursor.selectLeft();break;default:return!1}return d.preventDefault(),!1};a.onText=function(a){return this.cursor.write(a),
!1}});Q=g(t,function(a,b){a.init=function(a){b.init.call(this,"$");this.cursor=a};a.htmlTemplate='\x3cspan class\x3d"mathquill-rendered-math"\x3e\x260\x3c/span\x3e';a.createBlocks=function(){this.firstChild=this.lastChild=N();this.blocks=[this.firstChild];this.firstChild.parent=this;var a=this.firstChild.cursor=this.cursor;this.firstChild.onText=function(d){return"$"!==d||a.parent!==this?a.write(d):this.isEmpty()?a.insertAfter(this.parent).backspace().insertNew(c("\\$","$")).show():a.next?a.prev?
a.write(d):a.insertBefore(this.parent):a.insertAfter(this.parent),!1}};a.latex=function(){return"$"+this.firstChild.latex()+"$"}});fa=g(A,function(a){a.renderLatex=function(a){var e=this.cursor;this.jQ.children().slice(1).remove();this.firstChild=this.lastChild=0;e.show().appendTo(this);var d=q.regex,b=q.string,f=q.eof,v=q.all,U=b("$").then(F).skip(b("$").or(f)).map(function(a){var d=Q(e);d.createBlocks();var b=d.firstChild;return a.children().adopt(b,0,0),d}),d=b("\\$").result("$").or(d(/^[^$]/)).map(c);
if(a=U.or(d).many().skip(f).or(v.result(!1)).parse(a)){for(f=0;f<a.length;f+=1)a[f].adopt(this,this.lastChild,0);a=this.join("html");m.jQize(a).appendTo(this.jQ);this.finalizeInsert()}};a.onKey=N.prototype.onKey;a.onText=function(a){return this.cursor.prepareEdit(),"$"===a?this.cursor.insertNew(Q(this.cursor)):this.cursor.insertNew(c(a)),!1}});r={};a={};V=C;l=document.createElement("div").style;E={transform:1,WebkitTransform:1,MozTransform:1,OTransform:1,msTransform:1};for(Y in E)if(Y in l){X=Y;break}X?
J=function(a,b,e){a.css(X,"scale("+b+","+e+")")}:"filter"in l?(V=function(a){a.className=a.className},J=function(a,b,e){function d(){a.css("marginRight",(c.width()-1)*(b-1)/b+"px")}var c,h;b/=1+(e-1)/2;a.css("fontSize",e+"em");a.hasClass("matrixed-container")||a.addClass("matrixed-container").wrapInner('\x3cspan class\x3d"matrixed"\x3e\x3c/span\x3e');c=a.children().css("filter","progid:DXImageTransform.Microsoft.Matrix(M11\x3d"+b+",SizingMethod\x3d'auto expand')");d();h=setInterval(d);p(window).load(function(){clearTimeout(h);
d()})}):J=function(a,b,e){a.css("fontSize",e+"em")};l=g(t,function(a,b){a.init=function(a,d,f){b.init.call(this,a,"\x3c"+d+" "+f+"\x3e\x260\x3c/"+d+"\x3e")}});a.mathrm=b(l,"\\mathrm","span",'class\x3d"roman font"');a.mathit=b(l,"\\mathit","i",'class\x3d"font"');a.mathbf=b(l,"\\mathbf","b",'class\x3d"font"');a.mathsf=b(l,"\\mathsf","span",'class\x3d"sans-serif font"');a.mathtt=b(l,"\\mathtt","span",'class\x3d"monospace font"');a.underline=b(l,"\\underline","span",'class\x3d"non-leaf underline"');a.overline=
a.bar=b(l,"\\overline","span",'class\x3d"non-leaf overline"');B=g(t,function(a,b){a.init=function(a,d,f){b.init.call(this,a,"\x3c"+d+' class\x3d"non-leaf"\x3e\x260\x3c/'+d+"\x3e",[f])};a.finalizeTree=function(){function a(d){var e=this.parent,b=d;do{if(b.next)return d.insertBefore(e),!1;b=b.parent.parent}while(b!==e);return d.insertAfter(e),!1}y("SupSub is only _ and ^","^"===this.ctrlSeq||"_"===this.ctrlSeq);"_"===this.ctrlSeq?(this.down=this.firstChild,this.firstChild.up=a):(this.up=this.firstChild,
this.firstChild.down=a)};a.latex=function(){var a=this.firstChild.latex();return 1===a.length?this.ctrlSeq+a:this.ctrlSeq+"{"+(a||" ")+"}"};a.redraw=function(){this.prev&&this.prev.respace();this.prev instanceof B||(this.respace(),this.next&&!(this.next instanceof B)&&this.next.respace())};a.respace=function(){"\\int "===this.prev.ctrlSeq||this.prev instanceof B&&this.prev.ctrlSeq!=this.ctrlSeq&&this.prev.prev&&"\\int "===this.prev.prev.ctrlSeq?this.limit||(this.limit=!0,this.jQ.addClass("limit")):
this.limit&&(this.limit=!1,this.jQ.removeClass("limit"));if(this.respaced=this.prev instanceof B&&this.prev.ctrlSeq!=this.ctrlSeq&&!this.prev.respaced){var a=+this.jQ.css("fontSize").slice(0,-2),d=this.prev.jQ.outerWidth(),b=this.jQ.outerWidth();this.jQ.css({left:(this.limit&&"_"===this.ctrlSeq?-.25:0)-d/a+"em",marginRight:.1-aa(b,d)/a+"em"})}else this.limit&&"_"===this.ctrlSeq?this.jQ.css({left:"-.25em",marginRight:""}):this.jQ.css({left:"",marginRight:""});return this.next instanceof B&&this.next.respace(),
this}});a.subscript=a._=b(B,"_","sub","_");a.superscript=a.supscript=a["^"]=b(B,"^","sup","**");l=a.frac=a.dfrac=a.cfrac=a.fraction=g(t,function(a,b){a.ctrlSeq="\\frac";a.htmlTemplate='\x3cspan class\x3d"fraction non-leaf"\x3e\x3cspan class\x3d"numerator"\x3e\x260\x3c/span\x3e\x3cspan class\x3d"denominator"\x3e\x261\x3c/span\x3e\x3cspan style\x3d"display:inline-block;width:0"\x3e\x26nbsp;\x3c/span\x3e\x3c/span\x3e';a.textTemplate=["(","/",")"];a.finalizeTree=function(){this.up=this.lastChild.up=this.firstChild;
this.down=this.firstChild.down=this.lastChild}});ga=a.over=r["/"]=g(l,function(a,b){a.createBefore=function(a){if(!this.replacedFragment){for(var d=a.prev;d&&!(d instanceof k||d instanceof I||d instanceof H);)d=d.prev;d instanceof H&&d.next instanceof B&&(d=d.next,d.next instanceof B&&d.next.ctrlSeq!=d.ctrlSeq&&(d=d.next));d!==a.prev&&(this.replaces(M(d.next||a.parent.firstChild,a.prev)),a.prev=d)}b.createBefore.call(this,a)}});l=a.sqrt=a["√"]=g(t,function(a,b){a.ctrlSeq="\\sqrt";a.htmlTemplate='\x3cspan class\x3d"non-leaf"\x3e\x3cspan class\x3d"scaled sqrt-prefix"\x3e\x26radic;\x3c/span\x3e\x3cspan class\x3d"non-leaf sqrt-stem"\x3e\x260\x3c/span\x3e\x3c/span\x3e';
a.textTemplate=["sqrt(",")"];a.parser=function(){return F.optBlock.then(function(a){return F.block.map(function(d){var b=ha();return b.blocks=[a,d],a.adopt(b,0,0),d.adopt(b,a,0),b})}).or(b.parser.call(this))};a.redraw=function(){var a=this.lastChild.jQ;J(a.prev(),1,a.innerHeight()/+a.css("fontSize").slice(0,-2)-.1)}});ha=a.nthroot=g(l,function(a,b){a.htmlTemplate='\x3csup class\x3d"nthroot non-leaf"\x3e\x260\x3c/sup\x3e\x3cspan class\x3d"scaled"\x3e\x3cspan class\x3d"sqrt-prefix scaled"\x3e\x26radic;\x3c/span\x3e\x3cspan class\x3d"sqrt-stem non-leaf"\x3e\x261\x3c/span\x3e\x3c/span\x3e';
a.textTemplate=["sqrt[","](",")"];a.latex=function(){return"\\sqrt["+this.firstChild.latex()+"]{"+this.lastChild.latex()+"}"}});K=g(t,function(a,b){a.init=function(a,d,f,c){b.init.call(this,"\\left"+f,'\x3cspan class\x3d"non-leaf"\x3e\x3cspan class\x3d"scaled paren"\x3e'+a+'\x3c/span\x3e\x3cspan class\x3d"non-leaf"\x3e\x260\x3c/span\x3e\x3cspan class\x3d"scaled paren"\x3e'+d+"\x3c/span\x3e\x3c/span\x3e",[a,d]);this.end="\\right"+c};a.jQadd=function(){b.jQadd.apply(this,arguments);var a=this.jQ;this.bracketjQs=
a.children(":first").add(a.children(":last"))};a.latex=function(){return this.ctrlSeq+this.firstChild.latex()+this.end};a.redraw=function(){var a=this.firstChild.jQ,a=a.outerHeight()/+a.css("fontSize").slice(0,-2);J(this.bracketjQs,aa(1+.2*(a-1),1.2),1.05*a)}});a.left=g(t,function(a){a.parser=function(){var a,b,d=q.regex,f=q.string;return d=q.regex,a=q.succeed,b=q.optWhitespace,b.then(d(/^(?:[([|]|\\\{)/)).then(function(c){var v;return"\\"===c.charAt(0)&&(c=c.slice(1)),v=r[c](),F.map(function(a){v.blocks=
[a];a.adopt(v,0,0)}).then(f("\\right")).skip(b).then(d(/^(?:[\])|]|\\\})/)).then(function(d){return d.slice(-1)!==v.end.slice(-1)?q.fail("open doesn't match close"):a(v)})})}});a.right=g(t,function(a){a.parser=function(){return q.fail("unmatched \\right")}});a.lbrace=r["{"]=b(K,"{","}","\\{","\\}");a.langle=a.lang=b(K,"\x26lang;","\x26rang;","\\langle ","\\rangle ");O=g(K,function(a,b){a.createBefore=function(a){a.next||!a.parent.parent||a.parent.parent.end!==this.end||this.replacedFragment?b.createBefore.call(this,
a):a.insertAfter(a.parent.parent)};a.placeCursor=function(a){this.firstChild.blur();a.insertAfter(this)}});a.rbrace=r["}"]=b(O,"{","}","\\{","\\}");a.rangle=a.rang=b(O,"\x26lang;","\x26rang;","\\langle ","\\rangle ");E=function(a,b){a.init=function(a,d){b.init.call(this,a,d,a,d)}};l=g(K,E);a.lparen=r["("]=b(l,"(",")");a.lbrack=a.lbracket=r["["]=b(l,"[","]");E=g(O,E);a.rparen=r[")"]=b(E,"(",")");a.rbrack=a.rbracket=r["]"]=b(E,"[","]");a.lpipe=a.rpipe=r["|"]=g(l,function(a,b){a.init=function(){b.init.call(this,
"|","|")};a.createBefore=O.prototype.createBefore});I=r.$=a.text=a.textnormal=a.textrm=a.textup=a.textmd=g(t,function(a,b){a.ctrlSeq="\\text";a.htmlTemplate='\x3cspan class\x3d"text"\x3e\x260\x3c/span\x3e';a.replaces=function(a){a instanceof M?this.replacedText=a.remove().jQ.text():"string"==typeof a&&(this.replacedText=a)};a.textTemplate=['"','"'];a.parser=function(){var a=q.string,d=q.regex;return q.optWhitespace.then(a("{")).then(d(/^[^}]*/)).skip(a("}")).map(function(a){var d=I();d.createBlocks();
for(var b=d.firstChild,e=0;e<a.length;e+=1)c(a.charAt(e)).adopt(b,b.lastChild,0);return d})};a.createBlocks=function(){this.firstChild=this.lastChild=ia();this.blocks=[this.firstChild];this.firstChild.parent=this};a.finalizeInsert=function(){this.firstChild.blur=function(){return delete this.blur,this};b.finalizeInsert.call(this)};a.createBefore=function(a){b.createBefore.call(this,this.cursor=a);if(this.replacedText)for(a=0;a<this.replacedText.length;a+=1)this.write(this.replacedText.charAt(a))};
a.write=function(a){this.cursor.insertNew(c(a))};a.onKey=function(a,d){if(!this.cursor.selection&&("Backspace"===a&&!this.cursor.prev||"Del"===a&&!this.cursor.next))return this.isEmpty()&&this.cursor.insertAfter(this),!1};a.onText=function(a){this.cursor.prepareEdit();"$"!==a?this.write(a):this.isEmpty()?this.cursor.insertAfter(this).backspace().insertNew(c("\\$","$")):this.cursor.next?this.cursor.prev?(a=I(M(this.cursor.next,this.firstChild.lastChild)),a.placeCursor=function(a){this.prev=0;delete this.placeCursor;
this.placeCursor(a)},a.firstChild.focus=function(){return this},this.cursor.insertAfter(this).insertNew(a),a.prev=this,this.cursor.insertBefore(a),delete a.firstChild.focus):this.cursor.insertBefore(this):this.cursor.insertAfter(this);return!1}});ia=g(A,function(a,b){a.blur=function(){this.jQ.removeClass("hasCursor");if(this.isEmpty()){var a=this.parent,d=a.cursor;d.parent===this?this.jQ.addClass("empty"):(d.hide(),a.remove(),d.next===a?d.next=a.next:d.prev===a&&(d.prev=a.prev),d.show().parent.bubble("redraw"))}return this};
a.focus=function(){b.focus.call(this);var a=this.parent;if(a.next.ctrlSeq===a.ctrlSeq){var d=this,f=a.cursor,a=a.next.firstChild;a.eachChild(function(a){a.parent=d;a.jQ.appendTo(d.jQ)});this.lastChild?this.lastChild.next=a.firstChild:this.firstChild=a.firstChild;a.firstChild.prev=this.lastChild;this.lastChild=a.lastChild;a.parent.remove();f.prev?f.insertAfter(f.prev):f.prependTo(this);f.parent.bubble("redraw")}else a.prev.ctrlSeq===a.ctrlSeq&&(f=a.cursor,f.prev?a.prev.firstChild.focus():f.appendTo(a.prev.firstChild));
return this}});a.em=a.italic=a.italics=a.emph=a.textit=a.textsl=G("\\textit","i",'class\x3d"text"');a.strong=a.bold=a.textbf=G("\\textbf","b",'class\x3d"text"');a.sf=a.textsf=G("\\textsf","span",'class\x3d"sans-serif text"');a.tt=a.texttt=G("\\texttt","span",'class\x3d"monospace text"');a.textsc=G("\\textsc","span",'style\x3d"font-variant:small-caps" class\x3d"text"');a.uppercase=G("\\uppercase","span",'style\x3d"text-transform:uppercase" class\x3d"text"');a.lowercase=G("\\lowercase","span",'style\x3d"text-transform:lowercase" class\x3d"text"');
r["\\"]=g(t,function(a,b){a.ctrlSeq="\\";a.replaces=function(a){this._replacedFragment=a.disown();this.isEmpty=function(){return!1}};a.htmlTemplate='\x3cspan class\x3d"latex-command-input non-leaf"\x3e\\\x3cspan\x3e\x260\x3c/span\x3e\x3c/span\x3e';a.textTemplate=["\\"];a.createBlocks=function(){b.createBlocks.call(this);this.firstChild.focus=function(){return this.parent.jQ.addClass("hasCursor"),this.isEmpty()&&this.parent.jQ.removeClass("empty"),this};this.firstChild.blur=function(){return this.parent.jQ.removeClass("hasCursor"),
this.isEmpty()&&this.parent.jQ.addClass("empty"),this}};a.createBefore=function(a){b.createBefore.call(this,a);this.cursor=a.appendTo(this.firstChild);if(this._replacedFragment){var d=this.jQ[0];this.jQ=this._replacedFragment.jQ.addClass("blur").bind("mousedown mousemove",function(a){return p(a.target=d).trigger(a),!1}).insertBefore(this.jQ).add(this.jQ)}};a.latex=function(){return"\\"+this.firstChild.latex()+" "};a.onKey=function(a,d){if("Tab"===a||"Enter"===a||"Spacebar"===a)return this.renderCommand(),
d.preventDefault(),!1};a.onText=function(a){if(a.match(/[a-z]/i))return this.cursor.prepareEdit(),this.cursor.insertNew(c(a)),!1;this.renderCommand();if("\\"===a&&this.firstChild.isEmpty())return!1};a.renderCommand=function(){this.jQ=this.jQ.last();this.remove();this.next?this.cursor.insertBefore(this.next):this.cursor.appendTo(this.parent);var a=this.firstChild.latex();a||(a="backslash");this.cursor.insertCmd(a,this._replacedFragment)}});l=a.binom=a.binomial=g(t,function(a,b){a.ctrlSeq="\\binom";
a.htmlTemplate='\x3cspan class\x3d"paren scaled"\x3e(\x3c/span\x3e\x3cspan class\x3d"non-leaf"\x3e\x3cspan class\x3d"array non-leaf"\x3e\x3cspan\x3e\x260\x3c/span\x3e\x3cspan\x3e\x261\x3c/span\x3e\x3c/span\x3e\x3c/span\x3e\x3cspan class\x3d"paren scaled"\x3e)\x3c/span\x3e';a.textTemplate=["choose(",",",")"];a.redraw=function(){var a=this.jQ.eq(1),a=a.outerHeight()/+a.css("fontSize").slice(0,-2),d=this.jQ.filter(".paren");J(d,aa(1+.2*(a-1),1.2),1.05*a)}});a.choose=g(l,function(a){a.createBefore=ga.prototype.createBefore});
a.vector=g(t,function(a,b){a.ctrlSeq="\\vector";a.htmlTemplate='\x3cspan class\x3d"array"\x3e\x3cspan\x3e\x260\x3c/span\x3e\x3c/span\x3e';a.latex=function(){return"\\begin{matrix}"+this.foldChildren([],function(a,d){return a.push(d.latex()),a}).join("\\\\")+"\\end{matrix}"};a.text=function(){return"["+this.foldChildren([],function(a,d){return a.push(d.text()),a}).join()+"]"};a.createBefore=function(a){b.createBefore.call(this,this.cursor=a)};a.onKey=function(a,d){var b=this.cursor.parent;if(b.parent===
this){if("Enter"===a){var c=A();return c.parent=this,c.jQ=p("\x3cspan\x3e\x3c/span\x3e").attr(z,c.id).insertAfter(b.jQ),b.next?b.next.prev=c:this.lastChild=c,c.next=b.next,b.next=c,c.prev=b,this.bubble("redraw").cursor.appendTo(c),d.preventDefault(),!1}if("Tab"===a&&!b.next){if(b.isEmpty()){if(b.prev)return this.cursor.insertAfter(this),delete b.prev.next,this.lastChild=b.prev,b.jQ.remove(),this.bubble("redraw"),d.preventDefault(),!1;return}c=A();return c.parent=this,c.jQ=p("\x3cspan\x3e\x3c/span\x3e").attr(z,
c.id).appendTo(this.jQ),this.lastChild=c,b.next=c,c.prev=b,this.bubble("redraw").cursor.appendTo(c),d.preventDefault(),!1}if(8===d.which){if(b.isEmpty())return b.prev?(this.cursor.appendTo(b.prev),b.prev.next=b.next):(this.cursor.insertBefore(this),this.firstChild=b.next),b.next?b.next.prev=b.prev:this.lastChild=b.prev,b.jQ.remove(),this.isEmpty()?this.cursor.deleteForward():this.bubble("redraw"),d.preventDefault(),!1;if(!this.cursor.prev)return d.preventDefault(),!1}}}});a.editable=g(Q,function(a,
b){a.init=function(){t.prototype.init.call(this,"\\editable")};a.jQadd=function(){var a,d;b.jQadd.apply(this,arguments);a=this.firstChild.disown();d=this.jQ.children().detach();this.firstChild=this.lastChild=N();this.blocks=[this.firstChild];this.firstChild.parent=this;ba(this.jQ,this.firstChild,!1,!0);this.cursor=this.firstChild.cursor;a.children().adopt(this.firstChild,0,0);d.appendTo(this.firstChild.jQ);this.firstChild.cursor.appendTo(this.firstChild)};a.latex=function(){return this.firstChild.latex()};
a.text=function(){return this.firstChild.text()}});a.f=b(D,"f",'\x3cvar class\x3d"florin"\x3e\x26fnof;\x3c/var\x3e\x3cspan style\x3d"display:inline-block;width:0"\x3e\x26nbsp;\x3c/span\x3e');x=g(D,function(a,b){a.init=function(a,d){b.init.call(this,a,"\x3cvar\x3e"+(d||a)+"\x3c/var\x3e")};a.text=function(){var a=this.ctrlSeq;return this.prev&&!(this.prev instanceof x)&&!(this.prev instanceof k)&&(a="*"+a),this.next&&!(this.next instanceof k)&&"^"!==this.next.ctrlSeq&&(a+="*"),a}});c=g(D,function(a,
b){a.init=function(a,d){b.init.call(this,a,"\x3cspan\x3e"+(d||a)+"\x3c/span\x3e")}});r[" "]=b(c,"\\:"," ");a.prime=r["'"]=b(c,"'","\x26prime;");l=g(D,function(a,b){a.init=function(a,d){b.init.call(this,a,'\x3cspan class\x3d"nonSymbola"\x3e'+(d||a)+"\x3c/span\x3e")}});a["@"]=l;a["\x26"]=b(l,"\\\x26","\x26amp;");a["%"]=b(l,"\\%","%");a.alpha=a.beta=a.gamma=a.delta=a.zeta=a.eta=a.theta=a.iota=a.kappa=a.mu=a.nu=a.xi=a.rho=a.sigma=a.tau=a.chi=a.psi=a.omega=g(x,function(a,b){a.init=function(a){b.init.call(this,
"\\"+a+" ","\x26"+a+";")}});a.phi=b(x,"\\phi ","\x26#981;");a.phiv=a.varphi=b(x,"\\varphi ","\x26phi;");a.epsilon=b(x,"\\epsilon ","\x26#1013;");a.epsiv=a.varepsilon=b(x,"\\varepsilon ","\x26epsilon;");a.piv=a.varpi=b(x,"\\varpi ","\x26piv;");a.sigmaf=a.sigmav=a.varsigma=b(x,"\\varsigma ","\x26sigmaf;");a.thetav=a.vartheta=a.thetasym=b(x,"\\vartheta ","\x26thetasym;");a.upsilon=a.upsi=b(x,"\\upsilon ","\x26upsilon;");a.gammad=a.Gammad=a.digamma=b(x,"\\digamma ","\x26#989;");a.kappav=a.varkappa=b(x,
"\\varkappa ","\x26#1008;");a.rhov=a.varrho=b(x,"\\varrho ","\x26#1009;");a.pi=a["π"]=b(l,"\\pi ","\x26pi;");a.lambda=b(l,"\\lambda ","\x26lambda;");a.Upsilon=a.Upsi=a.upsih=a.Upsih=b(D,"\\Upsilon ",'\x3cvar style\x3d"font-family: serif"\x3e\x26upsih;\x3c/var\x3e');a.Gamma=a.Delta=a.Theta=a.Lambda=a.Xi=a.Pi=a.Sigma=a.Phi=a.Psi=a.Omega=a.forall=g(c,function(a,b){a.init=function(a){b.init.call(this,"\\"+a+" ","\x26"+a+";")}});l=g(t,function(a){a.init=function(a){this.latex=a};a.createBefore=function(a){a.writeLatex(this.latex)};
a.parser=function(){var a=F.parse(this.latex).children();return q.succeed(a)}});a["¹"]=b(l,"^1");a["²"]=b(l,"^2");a["³"]=b(l,"^3");a["¼"]=b(l,"\\frac14");a["½"]=b(l,"\\frac12");a["¾"]=b(l,"\\frac34");k=g(D,function(a,b){a.init=function(a,d,c){b.init.call(this,a,'\x3cspan class\x3d"binary-operator"\x3e'+d+"\x3c/span\x3e",c)}});l=g(k,function(a){a.init=c.prototype.init;a.respace=function(){return this.prev?this.prev instanceof k&&this.next&&!(this.next instanceof k)?this.jQ[0].className="unary-operator":
this.jQ[0].className="binary-operator":this.jQ[0].className="",this}});a["+"]=b(l,"+","+");a["–"]=a["-"]=b(l,"-","\x26minus;");a["±"]=a.pm=a.plusmn=a.plusminus=b(l,"\\pm ","\x26plusmn;");a.mp=a.mnplus=a.minusplus=b(l,"\\mp ","\x26#8723;");r["*"]=a.sdot=a.cdot=b(k,"\\cdot ","\x26middot;");a["\x3d"]=b(k,"\x3d","\x3d");a["\x3c"]=b(k,"\x3c","\x26lt;");a["\x3e"]=b(k,"\x3e","\x26gt;");a.notin=a.sim=a.cong=a.equiv=a.oplus=a.otimes=g(k,function(a,b){a.init=function(a){b.init.call(this,"\\"+a+" ","\x26"+a+
";")}});a.times=b(k,"\\times ","\x26times;","[x]");a["÷"]=a.div=a.divide=a.divides=b(k,"\\div ","\x26divide;","[/]");a["≠"]=a.ne=a.neq=b(k,"\\ne ","\x26ne;");a.ast=a.star=a.loast=a.lowast=b(k,"\\ast ","\x26lowast;");a.therefor=a.therefore=b(k,"\\therefore ","\x26there4;");a.cuz=a.because=b(k,"\\because ","\x26#8757;");a.prop=a.propto=b(k,"\\propto ","\x26prop;");a["≈"]=a.asymp=a.approx=b(k,"\\approx ","\x26asymp;");a.lt=b(k,"\x3c","\x26lt;");a.gt=b(k,"\x3e","\x26gt;");a["≤"]=a.le=a.leq=b(k,"\\le ",
"\x26le;");a["≥"]=a.ge=a.geq=b(k,"\\ge ","\x26ge;");a.isin=a["in"]=b(k,"\\in ","\x26isin;");a.ni=a.contains=b(k,"\\ni ","\x26ni;");a.notni=a.niton=a.notcontains=a.doesnotcontain=b(k,"\\not\\ni ","\x26#8716;");a.sub=a.subset=b(k,"\\subset ","\x26sub;");a.sup=a.supset=a.superset=b(k,"\\supset ","\x26sup;");a.nsub=a.notsub=a.nsubset=a.notsubset=b(k,"\\not\\subset ","\x26#8836;");a.nsup=a.notsup=a.nsupset=a.notsupset=a.nsuperset=a.notsuperset=b(k,"\\not\\supset ","\x26#8837;");a.sube=a.subeq=a.subsete=
a.subseteq=b(k,"\\subseteq ","\x26sube;");a.supe=a.supeq=a.supsete=a.supseteq=a.supersete=a.superseteq=b(k,"\\supseteq ","\x26supe;");a.nsube=a.nsubeq=a.notsube=a.notsubeq=a.nsubsete=a.nsubseteq=a.notsubsete=a.notsubseteq=b(k,"\\not\\subseteq ","\x26#8840;");a.nsupe=a.nsupeq=a.notsupe=a.notsupeq=a.nsupsete=a.nsupseteq=a.notsupsete=a.notsupseteq=a.nsupersete=a.nsuperseteq=a.notsupersete=a.notsuperseteq=b(k,"\\not\\supseteq ","\x26#8841;");H=g(D,function(a,b){a.init=function(a,d){b.init.call(this,a,
"\x3cbig\x3e"+d+"\x3c/big\x3e")}});a["∑"]=a.sum=a.summation=b(H,"\\sum ","\x26sum;");a["∏"]=a.prod=a.product=b(H,"\\prod ","\x26prod;");a.coprod=a.coproduct=b(H,"\\coprod ","\x26#8720;");a["∫"]=a["int"]=a.integral=b(H,"\\int ","\x26int;");a.N=a.naturals=a.Naturals=b(c,"\\mathbb{N}","\x26#8469;");a.P=a.primes=a.Primes=a.projective=a.Projective=a.probability=a.Probability=b(c,"\\mathbb{P}","\x26#8473;");a.Z=a.integers=a.Integers=b(c,"\\mathbb{Z}","\x26#8484;");a.Q=a.rationals=a.Rationals=b(c,"\\mathbb{Q}",
"\x26#8474;");a.R=a.reals=a.Reals=b(c,"\\mathbb{R}","\x26#8477;");a.C=a.complex=a.Complex=a.complexes=a.Complexes=a.complexplane=a.Complexplane=a.ComplexPlane=b(c,"\\mathbb{C}","\x26#8450;");a.H=a.Hamiltonian=a.quaternions=a.Quaternions=b(c,"\\mathbb{H}","\x26#8461;");a.quad=a.emsp=b(c,"\\quad ","    ");a.qquad=b(c,"\\qquad ","        ");a.diamond=b(c,"\\diamond ","\x26#9671;");a.bigtriangleup=b(c,"\\bigtriangleup ","\x26#9651;");a.ominus=b(c,"\\ominus ","\x26#8854;");a.uplus=b(c,"\\uplus ","\x26#8846;");
a.bigtriangledown=b(c,"\\bigtriangledown ","\x26#9661;");a.sqcap=b(c,"\\sqcap ","\x26#8851;");a.triangleleft=b(c,"\\triangleleft ","\x26#8882;");a.sqcup=b(c,"\\sqcup ","\x26#8852;");a.triangleright=b(c,"\\triangleright ","\x26#8883;");a.odot=b(c,"\\odot ","\x26#8857;");a.bigcirc=b(c,"\\bigcirc ","\x26#9711;");a.dagger=b(c,"\\dagger ","\x26#0134;");a.ddagger=b(c,"\\ddagger ","\x26#135;");a.wr=b(c,"\\wr ","\x26#8768;");a.amalg=b(c,"\\amalg ","\x26#8720;");a.models=b(c,"\\models ","\x26#8872;");a.prec=
b(c,"\\prec ","\x26#8826;");a.succ=b(c,"\\succ ","\x26#8827;");a.preceq=b(c,"\\preceq ","\x26#8828;");a.succeq=b(c,"\\succeq ","\x26#8829;");a.simeq=b(c,"\\simeq ","\x26#8771;");a.mid=b(c,"\\mid ","\x26#8739;");a.ll=b(c,"\\ll ","\x26#8810;");a.gg=b(c,"\\gg ","\x26#8811;");a.parallel=b(c,"\\parallel ","\x26#8741;");a.bowtie=b(c,"\\bowtie ","\x26#8904;");a.sqsubset=b(c,"\\sqsubset ","\x26#8847;");a.sqsupset=b(c,"\\sqsupset ","\x26#8848;");a.smile=b(c,"\\smile ","\x26#8995;");a.sqsubseteq=b(c,"\\sqsubseteq ",
"\x26#8849;");a.sqsupseteq=b(c,"\\sqsupseteq ","\x26#8850;");a.doteq=b(c,"\\doteq ","\x26#8784;");a.frown=b(c,"\\frown ","\x26#8994;");a.vdash=b(c,"\\vdash ","\x26#8870;");a.dashv=b(c,"\\dashv ","\x26#8867;");a.longleftarrow=b(c,"\\longleftarrow ","\x26#8592;");a.longrightarrow=b(c,"\\longrightarrow ","\x26#8594;");a.Longleftarrow=b(c,"\\Longleftarrow ","\x26#8656;");a.Longrightarrow=b(c,"\\Longrightarrow ","\x26#8658;");a.longleftrightarrow=b(c,"\\longleftrightarrow ","\x26#8596;");a.updownarrow=
b(c,"\\updownarrow ","\x26#8597;");a.Longleftrightarrow=b(c,"\\Longleftrightarrow ","\x26#8660;");a.Updownarrow=b(c,"\\Updownarrow ","\x26#8661;");a.mapsto=b(c,"\\mapsto ","\x26#8614;");a.nearrow=b(c,"\\nearrow ","\x26#8599;");a.hookleftarrow=b(c,"\\hookleftarrow ","\x26#8617;");a.hookrightarrow=b(c,"\\hookrightarrow ","\x26#8618;");a.searrow=b(c,"\\searrow ","\x26#8600;");a.leftharpoonup=b(c,"\\leftharpoonup ","\x26#8636;");a.rightharpoonup=b(c,"\\rightharpoonup ","\x26#8640;");a.swarrow=b(c,"\\swarrow ",
"\x26#8601;");a.leftharpoondown=b(c,"\\leftharpoondown ","\x26#8637;");a.rightharpoondown=b(c,"\\rightharpoondown ","\x26#8641;");a.nwarrow=b(c,"\\nwarrow ","\x26#8598;");a.ldots=b(c,"\\ldots ","\x26#8230;");a.cdots=b(c,"\\cdots ","\x26#8943;");a.vdots=b(c,"\\vdots ","\x26#8942;");a.ddots=b(c,"\\ddots ","\x26#8944;");a.surd=b(c,"\\surd ","\x26#8730;");a.triangle=b(c,"\\triangle ","\x26#9653;");a.ell=b(c,"\\ell ","\x26#8467;");a.top=b(c,"\\top ","\x26#8868;");a.flat=b(c,"\\flat ","\x26#9837;");a.natural=
b(c,"\\natural ","\x26#9838;");a.sharp=b(c,"\\sharp ","\x26#9839;");a.wp=b(c,"\\wp ","\x26#8472;");a.bot=b(c,"\\bot ","\x26#8869;");a.clubsuit=b(c,"\\clubsuit ","\x26#9827;");a.diamondsuit=b(c,"\\diamondsuit ","\x26#9826;");a.heartsuit=b(c,"\\heartsuit ","\x26#9825;");a.spadesuit=b(c,"\\spadesuit ","\x26#9824;");a.oint=b(c,"\\oint ","\x26#8750;");a.bigcap=b(c,"\\bigcap ","\x26#8745;");a.bigcup=b(c,"\\bigcup ","\x26#8746;");a.bigsqcup=b(c,"\\bigsqcup ","\x26#8852;");a.bigvee=b(c,"\\bigvee ","\x26#8744;");
a.bigwedge=b(c,"\\bigwedge ","\x26#8743;");a.bigodot=b(c,"\\bigodot ","\x26#8857;");a.bigotimes=b(c,"\\bigotimes ","\x26#8855;");a.bigoplus=b(c,"\\bigoplus ","\x26#8853;");a.biguplus=b(c,"\\biguplus ","\x26#8846;");a.lfloor=b(c,"\\lfloor ","\x26#8970;");a.rfloor=b(c,"\\rfloor ","\x26#8971;");a.lceil=b(c,"\\lceil ","\x26#8968;");a.rceil=b(c,"\\rceil ","\x26#8969;");a.slash=b(c,"\\slash ","\x26#47;");a.opencurlybrace=b(c,"\\opencurlybrace ","\x26#123;");a.closecurlybrace=b(c,"\\closecurlybrace ","\x26#125;");
a.caret=b(c,"\\caret ","^");a.underscore=b(c,"\\underscore ","_");a.backslash=b(c,"\\backslash ","\\");a.vert=b(c,"|");a.perp=a.perpendicular=b(c,"\\perp ","\x26perp;");a.nabla=a.del=b(c,"\\nabla ","\x26nabla;");a.hbar=b(c,"\\hbar ","\x26#8463;");a.AA=a.Angstrom=a.angstrom=b(c,"\\text\\AA ","\x26#8491;");a.ring=a.circ=a.circle=b(c,"\\circ ","\x26#8728;");a.bull=a.bullet=b(c,"\\bullet ","\x26bull;");a.setminus=a.smallsetminus=b(c,"\\setminus ","\x26#8726;");a.not=a["¬"]=a.neg=b(c,"\\neg ","\x26not;");
a["…"]=a.dots=a.ellip=a.hellip=a.ellipsis=a.hellipsis=b(c,"\\dots ","\x26hellip;");a.converges=a.darr=a.dnarr=a.dnarrow=a.downarrow=b(c,"\\downarrow ","\x26darr;");a.dArr=a.dnArr=a.dnArrow=a.Downarrow=b(c,"\\Downarrow ","\x26dArr;");a.diverges=a.uarr=a.uparrow=b(c,"\\uparrow ","\x26uarr;");a.uArr=a.Uparrow=b(c,"\\Uparrow ","\x26uArr;");a.to=b(k,"\\to ","\x26rarr;");a.rarr=a.rightarrow=b(c,"\\rightarrow ","\x26rarr;");a.implies=b(k,"\\Rightarrow ","\x26rArr;");a.rArr=a.Rightarrow=b(c,"\\Rightarrow ",
"\x26rArr;");a.gets=b(k,"\\gets ","\x26larr;");a.larr=a.leftarrow=b(c,"\\leftarrow ","\x26larr;");a.impliedby=b(k,"\\Leftarrow ","\x26lArr;");a.lArr=a.Leftarrow=b(c,"\\Leftarrow ","\x26lArr;");a.harr=a.lrarr=a.leftrightarrow=b(c,"\\leftrightarrow ","\x26harr;");a.iff=b(k,"\\Leftrightarrow ","\x26hArr;");a.hArr=a.lrArr=a.Leftrightarrow=b(c,"\\Leftrightarrow ","\x26hArr;");a.Re=a.Real=a.real=b(c,"\\Re ","\x26real;");a.Im=a.imag=a.image=a.imagin=a.imaginary=a.Imaginary=b(c,"\\Im ","\x26image;");a.part=
a.partial=b(c,"\\partial ","\x26part;");a.inf=a.infin=a.infty=a.infinity=b(c,"\\infty ","\x26infin;");a.alef=a.alefsym=a.aleph=a.alephsym=b(c,"\\aleph ","\x26alefsym;");a.xist=a.xists=a.exist=a.exists=b(c,"\\exists ","\x26exist;");a.and=a.land=a.wedge=b(c,"\\wedge ","\x26and;");a.or=a.lor=a.vee=b(c,"\\vee ","\x26or;");a.o=a.O=a.empty=a.emptyset=a.oslash=a.Oslash=a.nothing=a.varnothing=b(k,"\\varnothing ","\x26empty;");a.cup=a.union=b(k,"\\cup ","\x26cup;");a.cap=a.intersect=a.intersection=b(k,"\\cap ",
"\x26cap;");a.deg=a.degree=b(c,"^\\circ ","\x26deg;");a.ang=a.angle=b(c,"\\angle ","\x26ang;");Z=g(D,function(a,b){a.init=function(a){b.init.call(this,"\\"+a+" ","\x3cspan\x3e"+a+"\x3c/span\x3e")};a.respace=function(){this.jQ[0].className=this.next instanceof B||this.next instanceof K?"":"non-italicized-function"}});a.ln=a.lg=a.log=a.span=a.proj=a.det=a.dim=a.min=a.max=a.mod=a.lcm=a.gcd=a.gcf=a.hcf=a.lim=Z;(function(){var b,c="sin cos tan sec cosec csc cotan cot".split(" ");for(b in c)a[c[b]]=a[c[b]+
"h"]=a["a"+c[b]]=a["arc"+c[b]]=a["a"+c[b]+"h"]=a["arc"+c[b]+"h"]=Z})();F=function(){function b(a){for(var d=a[0]||A(),c=1;c<a.length;c+=1)a[c].children().adopt(d,d.lastChild,0);return d}var g=q.string,e=q.regex,d=q.any,n=q.optWhitespace,h=q.succeed,v=q.fail,k=q.letter.map(x),l=e(/^[^${}\\_^]/).map(c),e=e(/^[^\\]/).or(g("\\").then(e(/^[a-z]+/i).or(e(/^\s+/).result(" ")).or(d))).then(function(b){var d=a[b];return d?d(b).parser():v("unknown command: \\"+b)}).or(k).or(l),d=g("{").then(function(){return m}).skip(g("}")),
e=n.then(d.or(e.map(function(a){var b=A();return a.adopt(b,0,0),b}))),m=e.many().map(b).skip(n),g=g("[").then(e.then(function(a){return"]"!==a.join("latex")?h(a):v()}).many().map(b).skip(n)).skip(g("]")),n=m;return n.block=e,n.optBlock=g,n}();da=g(function(b){function g(a,b){if(a.next[b])a.prependTo(a.next[b]);else if(a.prev[b])a.appendTo(a.prev[b]);else{var c=a.parent;do{var f=c[b];if(f&&("function"==typeof f&&(f=c[b](a)),!1===f||f instanceof A)){a.upDownCache[c.id]={parent:a.parent,prev:a.prev,
next:a.next};f instanceof A&&((c=a.upDownCache[f.id])?c.next?a.insertBefore(c.next):a.appendTo(c.parent):(c=e(a).left,a.appendTo(f),a.seekHoriz(c,f)));break}c=c.parent.parent}while(c)}return a.clearSelection().show()}function e(a){var b=a.jQ.removeClass("cursor").offset();return a.jQ.addClass("cursor"),b}b.init=function(a){this.parent=this.root=a;var b=this.jQ=this._jQ=p('\x3cspan class\x3d"cursor"\x3e\x26zwj;\x3c/span\x3e');this.blink=function(){b.toggleClass("blink")};this.upDownCache={}};b.prev=
0;b.next=0;b.parent=0;b.show=function(){return this.jQ=this._jQ.removeClass("blink"),"intervalId"in this?clearInterval(this.intervalId):(this.next?this.selection&&this.selection.first.prev===this.prev?this.jQ.insertBefore(this.selection.jQ):this.jQ.insertBefore(this.next.jQ.first()):this.jQ.appendTo(this.parent.jQ),this.parent.focus()),this.intervalId=setInterval(this.blink,500),this};b.hide=function(){return"intervalId"in this&&clearInterval(this.intervalId),delete this.intervalId,this.jQ.detach(),
this.jQ=p(),this};b.insertAt=function(a,b,c){var e=this.parent;this.parent=a;this.prev=b;this.next=c;e.blur()};b.insertBefore=function(a){return this.insertAt(a.parent,a.prev,a),this.parent.jQ.addClass("hasCursor"),this.jQ.insertBefore(a.jQ.first()),this};b.insertAfter=function(a){return this.insertAt(a.parent,a,a.next),this.parent.jQ.addClass("hasCursor"),this.jQ.insertAfter(a.jQ.last()),this};b.prependTo=function(a){return this.insertAt(a,0,a.firstChild),a.textarea?this.jQ.insertAfter(a.textarea):
this.jQ.prependTo(a.jQ),a.focus(),this};b.appendTo=function(a){return this.insertAt(a,a.lastChild,0),this.jQ.appendTo(a.jQ),a.focus(),this};b.hopLeft=function(){return this.jQ.insertBefore(this.prev.jQ.first()),this.next=this.prev,this.prev=this.prev.prev,this};b.hopRight=function(){return this.jQ.insertAfter(this.next.jQ.last()),this.prev=this.next,this.next=this.next.next,this};b.moveLeftWithin=function(a){this.prev?this.prev.lastChild?this.appendTo(this.prev.lastChild):this.hopLeft():this.parent!==
a&&(this.parent.prev?this.appendTo(this.parent.prev):this.insertBefore(this.parent.parent))};b.moveRightWithin=function(a){this.next?this.next.firstChild?this.prependTo(this.next.firstChild):this.hopRight():this.parent!==a&&(this.parent.next?this.prependTo(this.parent.next):this.insertAfter(this.parent.parent))};b.moveLeft=function(){this.upDownCache={};return this.selection?this.insertBefore(this.selection.first).clearSelection():this.moveLeftWithin(this.root),this.show()};b.moveRight=function(){this.upDownCache=
{};return this.selection?this.insertAfter(this.selection.last).clearSelection():this.moveRightWithin(this.root),this.show()};b.moveUp=function(){return g(this,"up")};b.moveDown=function(){return g(this,"down")};b.seek=function(a,b,c){this.upDownCache={};var e,f;c=this.clearSelection().show();return a.hasClass("empty")?(c.prependTo(m[a.attr(z)]),c):(e=m[a.attr("mathquill-command-id")],e instanceof D?(a.outerWidth()>2*(b-a.offset().left)?c.insertBefore(e):c.insertAfter(e),c):(e||(f=m[a.attr(z)],f||
(a=a.parent(),e=m[a.attr("mathquill-command-id")],e||(f=m[a.attr(z)],f||(f=c.root)))),e?c.insertAfter(e):c.appendTo(f),c.seekHoriz(b,c.root)))};b.seekHoriz=function(a,b){var c=e(this).left-a,f;do this.moveLeftWithin(b),f=c,c=e(this).left-a;while(0<c&&(this.prev||this.parent!==b));return-c>f&&this.moveRightWithin(b),this};b.writeLatex=function(a){this.upDownCache={};this.show().deleteSelection();var b=q.all;a=F.skip(q.eof).or(b.result(!1)).parse(a);return a&&(a.children().adopt(this.parent,this.prev,
this.next),m.jQize(a.join("html")).insertBefore(this.jQ),this.prev=a.lastChild,a.finalizeInsert(),this.parent.bubble("redraw")),this.hide()};b.write=function(a){this.upDownCache={};return this.show().insertCh(a)};b.insertCh=function(b){var e;return b.match(/^[a-eg-zA-Z]$/)?e=x(b):(e=r[b]||a[b])?e=e(b):e=c(b),this.selection&&(this.prev=this.selection.first.prev,this.next=this.selection.last.next,e.replaces(this.selection),delete this.selection),this.insertNew(e)};b.insertNew=function(a){return a.createBefore(this),
this};b.insertCmd=function(b,c){var e=a[b];return e?(e=e(b),c&&e.replaces(c),this.insertNew(e)):(e=I(),e.replaces(b),e.firstChild.focus=function(){return delete this.focus,this},this.insertNew(e).insertAfter(e),c&&c.remove()),this};b.unwrapGramp=function(){var a=this.parent.parent,b=a.parent,c=a.next,e=a.prev;a.disown().eachChild(function(f){f.isEmpty()||(f.children().adopt(b,e,c).each(function(b){b.jQ.insertBefore(a.jQ.first())}),e=f.lastChild)});if(!this.next)if(this.prev)this.next=this.prev.next;
else for(;!this.next;){this.parent=this.parent.next;if(!this.parent){this.next=a.next;this.parent=b;break}this.next=this.parent.firstChild}this.next?this.insertBefore(this.next):this.appendTo(b);a.jQ.remove();a.prev&&a.prev.respace();a.next&&a.next.respace()};b.backspace=function(){this.upDownCache={};this.show();if(!this.deleteSelection())if(this.prev)this.prev.isEmpty()?this.prev=this.prev.remove().prev:this.selectLeft();else if(this.parent!==this.root){if(this.parent.parent.isEmpty())return this.insertAfter(this.parent.parent).backspace();
this.unwrapGramp()}return this.prev&&this.prev.respace(),this.next&&this.next.respace(),this.parent.bubble("redraw"),this};b.deleteForward=function(){this.upDownCache={};this.show();if(!this.deleteSelection())if(this.next)this.next.isEmpty()?this.next=this.next.remove().next:this.selectRight();else if(this.parent!==this.root){if(this.parent.parent.isEmpty())return this.insertBefore(this.parent.parent).deleteForward();this.unwrapGramp()}return this.prev&&this.prev.respace(),this.next&&this.next.respace(),
this.parent.bubble("redraw"),this};b.selectFrom=function(a){var b=this,c=a;a:for(;;){for(var e=this;e!==b.parent.parent;e=e.parent.parent)if(e.parent===c.parent){a=e;break a}for(e=a;e!==c.parent.parent;e=e.parent.parent)if(b.parent===e.parent){a=b;c=e;break a}b.parent.parent&&(b=b.parent.parent);c.parent.parent&&(c=c.parent.parent)}var f;if(a.next!==c){for(b=a;b;b=b.next)if(b===c.prev){f=!0;break}f||(f=c,c=a,a=f)}this.hide().selection=R(a.prev.next||a.parent.firstChild,c.next.prev||c.parent.lastChild);
this.insertAfter(c.next.prev||c.parent.lastChild);this.root.selectionChanged()};b.selectLeft=function(){this.upDownCache={};if(this.selection)if(this.selection.first===this.next)this.prev?this.hopLeft().selection.extendLeft():this.parent!==this.root&&this.insertBefore(this.parent.parent).selection.levelUp();else{this.hopLeft();if(this.selection.first===this.selection.last){this.clearSelection().show();return}this.selection.retractLeft()}else{if(this.prev)this.hopLeft();else{if(this.parent===this.root)return;
this.insertBefore(this.parent.parent)}this.hide().selection=R(this.next)}this.root.selectionChanged()};b.selectRight=function(){this.upDownCache={};if(this.selection)if(this.selection.last===this.prev)this.next?this.hopRight().selection.extendRight():this.parent!==this.root&&this.insertAfter(this.parent.parent).selection.levelUp();else{this.hopRight();if(this.selection.first===this.selection.last){this.clearSelection().show();return}this.selection.retractRight()}else{if(this.next)this.hopRight();
else{if(this.parent===this.root)return;this.insertAfter(this.parent.parent)}this.hide().selection=R(this.prev)}this.root.selectionChanged()};b.prepareMove=function(){this.upDownCache={};return this.show().clearSelection()};b.prepareEdit=function(){this.upDownCache={};return this.show().deleteSelection()};b.clearSelection=function(){return this.selection&&(this.selection.clear(),delete this.selection,this.root.selectionChanged()),this};b.deleteSelection=function(){return this.selection?(this.prev=
this.selection.first.prev,this.next=this.selection.last.next,this.selection.remove(),this.root.selectionChanged(),delete this.selection):!1}});R=g(M,function(a,b){a.init=function(){b.init.apply(this,arguments);this.jQwrap(this.jQ)};a.jQwrap=function(a){this.jQ=a.wrapAll('\x3cspan class\x3d"selection"\x3e\x3c/span\x3e').parent()};a.adopt=function(){return this.jQ.replaceWith(this.jQ=this.jQ.children()),b.adopt.apply(this,arguments)};a.clear=function(){return this.jQ.replaceWith(this.jQ.children()),
this};a.levelUp=function(){var a=this.first=this.last=this.last.parent.parent;return this.clear().jQwrap(a.jQ),this};a.extendLeft=function(){this.first=this.first.prev;this.first.jQ.prependTo(this.jQ)};a.extendRight=function(){this.last=this.last.next;this.last.jQ.appendTo(this.jQ)};a.retractRight=function(){this.first.jQ.insertBefore(this.jQ);this.first=this.first.next};a.retractLeft=function(){this.last.jQ.insertAfter(this.jQ);this.last=this.last.prev}});p.fn.mathquill=function(a,b){var c,d,g,h,
k;switch(a){case "redraw":return this.each(function(){var a=p(this).attr(z);(a=a&&m[a])&&function ja(a){a.eachChild(ja);a.redraw&&a.redraw()}(a)});case "revert":return this.each(function(){var a=p(this).attr(z);(a=a&&m[a])&&a.revert&&a.revert()});case "latex":return 1<arguments.length?this.each(function(){var a=p(this).attr(z);(a=a&&m[a])&&a.renderLatex(b)}):(c=p(this).attr(z),d=c&&m[c],d&&d.latex());case "text":return c=p(this).attr(z),d=c&&m[c],d&&d.text();case "html":return this.html().replace(/ ?hasCursor|hasCursor /,
"").replace(/ class=(""|(?= |>))/g,"").replace(/<span class="?cursor( blink)?"?><\/span>/i,"").replace(/<span class="?textarea"?><textarea><\/textarea><\/span>/i,"");case "write":if(1<arguments.length)return this.each(function(){var a=p(this).attr(z);(a=(a=a&&m[a])&&a.cursor)&&a.writeLatex(b).parent.blur()});case "cmd":if(1<arguments.length)return this.each(function(){var a,c=p(this).attr(z);(c=(c=c&&m[c])&&c.cursor)&&(c.show(),/^\\[a-z]+$/i.test(b)?(a=c.selection,a&&(c.prev=a.first.prev,c.next=a.last.next,
delete c.selection),c.insertCmd(b.slice(1),a)):c.insertCh(b),c.hide().parent.blur())});default:return g="textbox"===a,h=g||"editable"===a,k=g?fa:N,this.each(function(){ba(p(this),k(),g,h)})}};p(function(){p(".mathquill-editable:not(.mathquill-rendered-math)").mathquill("editable");p(".mathquill-textbox:not(.mathquill-rendered-math)").mathquill("textbox");p(".mathquill-embedded-latex").mathquill()})})();